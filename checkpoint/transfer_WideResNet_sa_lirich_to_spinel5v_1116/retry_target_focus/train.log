11-16 15:10:59 data_name: Battery_inconsistent
11-16 15:10:59 data_dir: ./my_datasets/Battery
11-16 15:10:59 csv: ./my_datasets/Battery/battery_cycles_labeled.csv
11-16 15:10:59 normlizetype: mean-std
11-16 15:10:59 method: sngp
11-16 15:10:59 gp_hidden_dim: 2048
11-16 15:10:59 spectral_norm_bound: 0.95
11-16 15:10:59 n_power_iterations: 1
11-16 15:10:59 nesterov: True
11-16 15:10:59 print_freq: 10
11-16 15:10:59 layers: 16
11-16 15:10:59 widen_factor: 1
11-16 15:10:59 droprate: 0.3
11-16 15:10:59 cuda_device: 0
11-16 15:10:59 checkpoint_dir: ./checkpoint
11-16 15:10:59 pretrained: True
11-16 15:10:59 batch_size: 64
11-16 15:10:59 num_workers: 0
11-16 15:10:59 bottleneck: True
11-16 15:10:59 bottleneck_num: 128
11-16 15:10:59 last_batch: False
11-16 15:10:59 hidden_size: 1024
11-16 15:10:59 trade_off_adversarial: Step
11-16 15:10:59 lam_adversarial: 1
11-16 15:10:59 opt: adam
11-16 15:10:59 lr: 0.0005
11-16 15:10:59 momentum: 0.9
11-16 15:10:59 weight_decay: 1e-05
11-16 15:10:59 lr_scheduler: step
11-16 15:10:59 gamma: 0.1
11-16 15:10:59 steps: 150, 250
11-16 15:10:59 middle_epoch: 15
11-16 15:10:59 max_epoch: 62
11-16 15:10:59 print_step: 25
11-16 15:10:59 inconsistent: UAN
11-16 15:10:59 model_name: WideResNet_sa
11-16 15:10:59 th: 0.5
11-16 15:10:59 input_channels: 22
11-16 15:10:59 classification_label: eol_class
11-16 15:10:59 sequence_length: 32
11-16 15:10:59 cycles_per_file: 50
11-16 15:10:59 sample_random_state: 42
11-16 15:10:59 transfer_task: [[0], [1]]
11-16 15:10:59 source_cathode: ['Li1.2Ni0.3Mn0.6O2', 'Li1.35Ni0.33Mn0.67O2.35']
11-16 15:10:59 target_cathode: ['5Vspinel']
11-16 15:10:59 num_classes: 5
11-16 15:10:59 domain_temperature: 1.0
11-16 15:10:59 class_temperature: 10.0
11-16 15:10:59 lambda_src: 0.0
11-16 15:10:59 lambda_src_decay_patience: 2
11-16 15:10:59 lambda_src_decay_factor: 0.5
11-16 15:10:59 lambda_src_min: 0.0
11-16 15:10:59 lambda_src_warmup: 0
11-16 15:10:59 improvement_metric: common
11-16 15:10:59 auto_select: True
11-16 15:10:59 llm_compare: True
11-16 15:10:59 llm_backend: openai
11-16 15:10:59 llm_model: None
11-16 15:10:59 llm_context: 
11-16 15:10:59 llm_cfg_inputs: {'text_context': "Dataset: Argonne National Laboratory battery aging time-series with partial cycle windows.\nSource cathodes: (all available); target cathodes: (none specified).\nLabel column 'eol_class' with ~None classes; sequence length 32; 7 channels covering cycle_number, energy_charge, capacity_charge, energy_discharge, capacity_discharge, cycle_start, cycle_duration.", 'numeric_summary': {'dataset': 'Battery_inconsistent', 'sequence_length_requested': 32, 'notes': 'label_inconsistent', 'lr_hint': 0.001, 'dropout_hint': 0.3, 'num_classes_hint': None, 'splits': {}, 'dataset_variant': 'argonne_battery', 'feature_names': ['cycle_number', 'energy_charge', 'capacity_charge', 'energy_discharge', 'capacity_discharge', 'cycle_start', 'cycle_duration'], 'source_cathodes': [], 'target_cathodes': [], 'label_column': 'eol_class'}}
11-16 15:10:59 llm_cfg: {'architecture': 'cnn_1d_sa', 'model_name': 'cnn_features_1d_sa', 'self_attention': True, 'sngp': True, 'openmax': False, 'use_unknown_head': False, 'bottleneck': 128, 'dropout': 0.3, 'learning_rate': 0.001, 'batch_size': 64, 'lambda_src': 0.0, 'rationale': 'The dataset has short sequences (32 steps) and 7 channels, making a 1-D CNN with self-attention ideal to capture local and some longer-range dependencies without excessive memory use. Label inconsistency suggests avoiding openmax or unknown heads to reduce tuning complexity. Moderate dropout (0.3) helps prevent overfitting given small data and attention. Batch size 64 balances GPU efficiency and stable training. Label inconsistency flagged → calibrated heads (SNGP/OpenMax) stay enabled for open-set robustness. Enabled SNGP to stabilise open-set transfer risk detected in metadata.', '_provider': 'openai', '_raw': '{\n  "model_name": "cnn_features_1d_sa",\n  "self_attention": true,\n  "sngp": false,\n  "openmax": false,\n  "use_unknown_head": false,\n  "bottleneck": 128,\n  "dropout": 0.3,\n  "learning_rate": 0.001,\n  "batch_size": 64,\n  "lambda_src": 0.0,\n  "rationale": "The dataset has short sequences (32 steps) and 7 channels, making a 1-D CNN with self-attention ideal to capture local and some longer-range dependencies without excessive memory use. Label inconsistency suggests avoiding openmax or unknown heads to reduce tuning complexity. Moderate dropout (0.3) helps prevent overfitting given small data and attention. Batch size 64 balances GPU efficiency and stable training."\n}'}
11-16 15:10:59 llm_cfg_stamp: 20251116_144741
11-16 15:10:59 tag: sngp_wrn_sa_20251116_144741
11-16 15:10:59 pretrained_model_path: ./checkpoint/transfer_WideResNet_sa_lirich_to_spinel5v_1116/best_model.pth
11-16 15:10:59 dataset_cycle_stats: {'source_train_cycles': 400, 'source_val_cycles': 100, 'source_val_has_holdout': True, 'target_train_cycles': 2050, 'target_val_cycles': 600, 'target_val_has_holdout': True, 'source_train_sequences': 152, 'source_val_sequences': 38, 'target_train_sequences': 779, 'target_val_sequences': 228, 'source_train_cells': 6, 'source_val_cells': 2, 'target_train_cells': 5, 'target_val_cells': 2, 'cycles_per_cell_per_cathode': {'source_train': {'Li1.2Ni0.3Mn0.6O2': [{'filename': 'batch_B3A_cell_4.h5', 'cycles': 50}, {'filename': 'batch_B3B_cell_1.h5', 'cycles': 50}, {'filename': 'batch_B3B_cell_2.h5', 'cycles': 50}, {'filename': 'batch_B3B_cell_3.h5', 'cycles': 50}, {'filename': 'batch_B3B_cell_7.h5', 'cycles': 50}], 'Li1.35Ni0.33Mn0.67O2.35': [{'filename': 'batch_B13A_cell_4.h5', 'cycles': 50}, {'filename': 'batch_B13A_cell_8.h5', 'cycles': 50}, {'filename': 'batch_B8A_cell_1.h5', 'cycles': 50}]}, 'source_val': {'Li1.2Ni0.3Mn0.6O2': [{'filename': 'batch_B3B_cell_5.h5', 'cycles': 50}], 'Li1.35Ni0.33Mn0.67O2.35': [{'filename': 'batch_B13A_cell_13.h5', 'cycles': 50}]}, 'target_train': {'5Vspinel': [{'filename': 'batch_B11B_cell_4.h5', 'cycles': 50}, {'filename': 'batch_B26U_cell_5.h5', 'cycles': 50}, {'filename': 'batch_B26V_cell_3.h5', 'cycles': 50}, {'filename': 'batch_B26V_cell_4.h5', 'cycles': 50}, {'filename': 'batch_B26V_cell_5.h5', 'cycles': 50}, {'filename': 'batch_B26W_cell_1.h5', 'cycles': 50}, {'filename': 'batch_B26W_cell_3.h5', 'cycles': 50}, {'filename': 'batch_B26W_cell_4.h5', 'cycles': 50}, {'filename': 'batch_B26W_cell_5.h5', 'cycles': 50}, {'filename': 'batch_B26X_cell_1.h5', 'cycles': 50}, {'filename': 'batch_B26X_cell_3.h5', 'cycles': 50}, {'filename': 'batch_B26X_cell_4.h5', 'cycles': 50}, {'filename': 'batch_B26Y_cell_3.h5', 'cycles': 50}, {'filename': 'batch_B26Y_cell_4.h5', 'cycles': 50}, {'filename': 'batch_B26Y_cell_5.h5', 'cycles': 50}, {'filename': 'batch_B26Z_cell_1.h5', 'cycles': 50}, {'filename': 'batch_B26Z_cell_3.h5', 'cycles': 50}, {'filename': 'batch_B5A_cell_1.h5', 'cycles': 50}, {'filename': 'batch_B5A_cell_5.h5', 'cycles': 50}, {'filename': 'batch_B26V_cell_1.h5', 'cycles': 50}, {'filename': 'batch_B26T_cell_5.h5', 'cycles': 50}, {'filename': 'batch_B26AA_cell_1.h5', 'cycles': 50}, {'filename': 'batch_B26T_cell_4.h5', 'cycles': 50}, {'filename': 'batch_B26AA_cell_4.h5', 'cycles': 50}, {'filename': 'batch_B26K_cell_1.h5', 'cycles': 50}, {'filename': 'batch_B26L_cell_1.h5', 'cycles': 50}, {'filename': 'batch_B26N_cell_1.h5', 'cycles': 50}, {'filename': 'batch_B26O_cell_1.h5', 'cycles': 50}, {'filename': 'batch_B26O_cell_4.h5', 'cycles': 50}, {'filename': 'batch_B26O_cell_5.h5', 'cycles': 50}, {'filename': 'batch_B26P_cell_3.h5', 'cycles': 50}, {'filename': 'batch_B26P_cell_4.h5', 'cycles': 50}, {'filename': 'batch_B26Q_cell_3.h5', 'cycles': 50}, {'filename': 'batch_B26Q_cell_5.h5', 'cycles': 50}, {'filename': 'batch_B26R_cell_1.h5', 'cycles': 50}, {'filename': 'batch_B26R_cell_3.h5', 'cycles': 50}, {'filename': 'batch_B26R_cell_4.h5', 'cycles': 50}, {'filename': 'batch_B26S_cell_3.h5', 'cycles': 50}, {'filename': 'batch_B26S_cell_4.h5', 'cycles': 50}, {'filename': 'batch_B26S_cell_5.h5', 'cycles': 50}, {'filename': 'batch_B5A_cell_7.h5', 'cycles': 50}]}, 'target_val': {'5Vspinel': [{'filename': 'batch_B26K_cell_2.h5', 'cycles': 50}, {'filename': 'batch_B26L_cell_2.h5', 'cycles': 50}, {'filename': 'batch_B26M_cell_2.h5', 'cycles': 50}, {'filename': 'batch_B26P_cell_2.h5', 'cycles': 50}, {'filename': 'batch_B26P_cell_6.h5', 'cycles': 50}, {'filename': 'batch_B26R_cell_2.h5', 'cycles': 50}, {'filename': 'batch_B26T_cell_2.h5', 'cycles': 50}, {'filename': 'batch_B26V_cell_2.h5', 'cycles': 50}, {'filename': 'batch_B26X_cell_2.h5', 'cycles': 50}, {'filename': 'batch_B26Y_cell_2.h5', 'cycles': 50}, {'filename': 'batch_B26Z_cell_2.h5', 'cycles': 50}, {'filename': 'batch_B5A_cell_2.h5', 'cycles': 50}]}}}
11-16 15:10:59 input_size: 32
11-16 15:10:59 reinit_head: False
11-16 15:10:59 using 1 cpu
11-16 15:10:59 Exception in callback functools.partial(<bound method OutStream._flush of <spyder_kernels.console.outstream.TTYOutStream object at 0x172cdca90>>)
Traceback (most recent call last):
  File "/Users/moondiab/opt/anaconda3/envs/venv/lib/python3.11/site-packages/jupyter_client/session.py", line 100, in json_packer
    ).encode("utf8", errors="surrogateescape")
      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
UnicodeEncodeError: 'utf-8' codec can't encode characters in position 866-867: surrogates not allowed

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/moondiab/opt/anaconda3/envs/venv/lib/python3.11/site-packages/tornado/ioloop.py", line 750, in _run_callback
    ret = callback()
          ^^^^^^^^^^
  File "/Users/moondiab/opt/anaconda3/envs/venv/lib/python3.11/site-packages/ipykernel/iostream.py", line 649, in _flush
    self.session.send(
  File "/Users/moondiab/opt/anaconda3/envs/venv/lib/python3.11/site-packages/jupyter_client/session.py", line 852, in send
    to_send = self.serialize(msg, ident)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/moondiab/opt/anaconda3/envs/venv/lib/python3.11/site-packages/jupyter_client/session.py", line 721, in serialize
    content = self.pack(content)
              ^^^^^^^^^^^^^^^^^^
  File "/Users/moondiab/opt/anaconda3/envs/venv/lib/python3.11/site-packages/jupyter_client/session.py", line 108, in json_packer
    ).encode("utf8", errors="surrogateescape")
      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
UnicodeEncodeError: 'utf-8' codec can't encode characters in position 866-867: surrogates not allowed
11-16 19:32:21 data_name: Battery_inconsistent
11-16 19:32:21 data_dir: ./my_datasets/Battery
11-16 19:32:21 csv: ./my_datasets/Battery/battery_cycles_labeled.csv
11-16 19:32:21 normlizetype: mean-std
11-16 19:32:21 method: sngp
11-16 19:32:21 gp_hidden_dim: 2048
11-16 19:32:21 spectral_norm_bound: 0.95
11-16 19:32:21 n_power_iterations: 1
11-16 19:32:21 nesterov: True
11-16 19:32:21 print_freq: 10
11-16 19:32:21 layers: 16
11-16 19:32:21 widen_factor: 1
11-16 19:32:21 droprate: 0.3
11-16 19:32:21 cuda_device: 0
11-16 19:32:21 checkpoint_dir: ./checkpoint
11-16 19:32:21 pretrained: True
11-16 19:32:21 batch_size: 64
11-16 19:32:21 num_workers: 0
11-16 19:32:21 bottleneck: True
11-16 19:32:21 bottleneck_num: 128
11-16 19:32:21 last_batch: False
11-16 19:32:21 hidden_size: 1024
11-16 19:32:21 trade_off_adversarial: Step
11-16 19:32:21 lam_adversarial: 1
11-16 19:32:21 opt: adam
11-16 19:32:21 lr: 5e-05
11-16 19:32:21 momentum: 0.9
11-16 19:32:21 weight_decay: 1e-05
11-16 19:32:21 lr_scheduler: step
11-16 19:32:21 gamma: 0.1
11-16 19:32:21 steps: 150, 250
11-16 19:32:21 middle_epoch: 15
11-16 19:32:21 max_epoch: 62
11-16 19:32:21 print_step: 25
11-16 19:32:21 inconsistent: UAN
11-16 19:32:21 model_name: WideResNet_sa
11-16 19:32:21 th: 0.5
11-16 19:32:21 input_channels: 22
11-16 19:32:21 classification_label: eol_class
11-16 19:32:21 sequence_length: 32
11-16 19:32:21 cycles_per_file: 20
11-16 19:32:21 sample_random_state: 42
11-16 19:32:21 transfer_task: [[0], [1]]
11-16 19:32:21 source_cathode: ['Li1.2Ni0.3Mn0.6O2', 'Li1.35Ni0.33Mn0.67O2.35']
11-16 19:32:21 target_cathode: ['5Vspinel']
11-16 19:32:21 num_classes: 5
11-16 19:32:21 domain_temperature: 1.0
11-16 19:32:21 class_temperature: 10.0
11-16 19:32:21 lambda_src: 0.0
11-16 19:32:21 lambda_src_decay_patience: 2
11-16 19:32:21 lambda_src_decay_factor: 0.5
11-16 19:32:21 lambda_src_min: 0.0
11-16 19:32:21 lambda_src_warmup: 0
11-16 19:32:21 improvement_metric: common
11-16 19:32:21 auto_select: True
11-16 19:32:21 llm_compare: True
11-16 19:32:21 llm_backend: openai
11-16 19:32:21 llm_model: None
11-16 19:32:21 llm_context: 
11-16 19:32:21 llm_cfg_inputs: {'text_context': "Dataset: Argonne National Laboratory battery aging time-series with partial cycle windows.\nSource cathodes: (all available); target cathodes: (none specified).\nLabel column 'eol_class' with ~None classes; sequence length 32; 7 channels covering cycle_number, energy_charge, capacity_charge, energy_discharge, capacity_discharge, cycle_start, cycle_duration.", 'numeric_summary': {'dataset': 'Battery_inconsistent', 'sequence_length_requested': 32, 'notes': 'label_inconsistent', 'lr_hint': 0.001, 'dropout_hint': 0.3, 'num_classes_hint': None, 'splits': {}, 'dataset_variant': 'argonne_battery', 'feature_names': ['cycle_number', 'energy_charge', 'capacity_charge', 'energy_discharge', 'capacity_discharge', 'cycle_start', 'cycle_duration'], 'source_cathodes': [], 'target_cathodes': [], 'label_column': 'eol_class'}}
11-16 19:32:21 llm_cfg: {'architecture': 'cnn_1d_sa', 'model_name': 'cnn_features_1d_sa', 'self_attention': True, 'sngp': True, 'openmax': False, 'use_unknown_head': False, 'bottleneck': 128, 'dropout': 0.3, 'learning_rate': 0.001, 'batch_size': 64, 'lambda_src': 0.0, 'rationale': 'The dataset has short sequences (32 steps) and 7 channels, making a lightweight CNN with self-attention ideal to capture local features and some long-range dependencies. Label inconsistency suggests avoiding openmax or unknown heads to reduce complexity. Dropout at 0.3 balances overfitting risk from attention layers on a small dataset. Batch size 64 and learning rate 0.001 align with hints and ensure stable training. Label inconsistency flagged → calibrated heads (SNGP/OpenMax) stay enabled for open-set robustness. Enabled SNGP to stabilise open-set transfer risk detected in metadata.', '_provider': 'openai', '_raw': '{\n  "model_name": "cnn_features_1d_sa",\n  "self_attention": true,\n  "sngp": false,\n  "openmax": false,\n  "use_unknown_head": false,\n  "bottleneck": 128,\n  "dropout": 0.3,\n  "learning_rate": 0.001,\n  "batch_size": 64,\n  "lambda_src": 0.0,\n  "rationale": "The dataset has short sequences (32 steps) and 7 channels, making a lightweight CNN with self-attention ideal to capture local features and some long-range dependencies. Label inconsistency suggests avoiding openmax or unknown heads to reduce complexity. Dropout at 0.3 balances overfitting risk from attention layers on a small dataset. Batch size 64 and learning rate 0.001 align with hints and ensure stable training."\n}'}
11-16 19:32:21 llm_cfg_stamp: 20251116_192719
11-16 19:32:21 tag: sngp_wrn_sa_20251116_192719
11-16 19:32:21 pretrained_model_path: ./checkpoint/transfer_WideResNet_sa_lirich_to_spinel5v_1116/best_model.pth
11-16 19:32:21 dataset_cycle_stats: {'source_train_cycles': 160, 'source_val_cycles': 40, 'source_val_has_holdout': True, 'target_train_cycles': 820, 'target_val_cycles': 240, 'target_val_has_holdout': True, 'source_train_sequences': 8, 'source_val_sequences': 2, 'target_train_sequences': 41, 'target_val_sequences': 12, 'source_train_cells': 6, 'source_val_cells': 2, 'target_train_cells': 5, 'target_val_cells': 2, 'cycles_per_cell_per_cathode': {'source_train': {'Li1.2Ni0.3Mn0.6O2': [{'filename': 'batch_B3A_cell_4.h5', 'cycles': 20, 'total_cycles': 181}, {'filename': 'batch_B3B_cell_1.h5', 'cycles': 20, 'total_cycles': 181}, {'filename': 'batch_B3B_cell_2.h5', 'cycles': 20, 'total_cycles': 181}, {'filename': 'batch_B3B_cell_3.h5', 'cycles': 20, 'total_cycles': 180}, {'filename': 'batch_B3B_cell_7.h5', 'cycles': 20, 'total_cycles': 180}], 'Li1.35Ni0.33Mn0.67O2.35': [{'filename': 'batch_B13A_cell_4.h5', 'cycles': 20, 'total_cycles': 169}, {'filename': 'batch_B13A_cell_8.h5', 'cycles': 20, 'total_cycles': 218}, {'filename': 'batch_B8A_cell_1.h5', 'cycles': 20, 'total_cycles': 214}]}, 'source_val': {'Li1.2Ni0.3Mn0.6O2': [{'filename': 'batch_B3B_cell_5.h5', 'cycles': 20, 'total_cycles': 180}], 'Li1.35Ni0.33Mn0.67O2.35': [{'filename': 'batch_B13A_cell_13.h5', 'cycles': 20, 'total_cycles': 218}]}, 'target_train': {'5Vspinel': [{'filename': 'batch_B11B_cell_4.h5', 'cycles': 20, 'total_cycles': 216}, {'filename': 'batch_B26U_cell_5.h5', 'cycles': 20, 'total_cycles': 219}, {'filename': 'batch_B26V_cell_3.h5', 'cycles': 20, 'total_cycles': 420}, {'filename': 'batch_B26V_cell_4.h5', 'cycles': 20, 'total_cycles': 420}, {'filename': 'batch_B26V_cell_5.h5', 'cycles': 20, 'total_cycles': 219}, {'filename': 'batch_B26W_cell_1.h5', 'cycles': 20, 'total_cycles': 420}, {'filename': 'batch_B26W_cell_3.h5', 'cycles': 20, 'total_cycles': 420}, {'filename': 'batch_B26W_cell_4.h5', 'cycles': 20, 'total_cycles': 420}, {'filename': 'batch_B26W_cell_5.h5', 'cycles': 20, 'total_cycles': 219}, {'filename': 'batch_B26X_cell_1.h5', 'cycles': 20, 'total_cycles': 420}, {'filename': 'batch_B26X_cell_3.h5', 'cycles': 20, 'total_cycles': 420}, {'filename': 'batch_B26X_cell_4.h5', 'cycles': 20, 'total_cycles': 420}, {'filename': 'batch_B26Y_cell_3.h5', 'cycles': 20, 'total_cycles': 420}, {'filename': 'batch_B26Y_cell_4.h5', 'cycles': 20, 'total_cycles': 420}, {'filename': 'batch_B26Y_cell_5.h5', 'cycles': 20, 'total_cycles': 219}, {'filename': 'batch_B26Z_cell_1.h5', 'cycles': 20, 'total_cycles': 219}, {'filename': 'batch_B26Z_cell_3.h5', 'cycles': 20, 'total_cycles': 219}, {'filename': 'batch_B5A_cell_1.h5', 'cycles': 20, 'total_cycles': 846}, {'filename': 'batch_B5A_cell_5.h5', 'cycles': 20, 'total_cycles': 855}, {'filename': 'batch_B26V_cell_1.h5', 'cycles': 20, 'total_cycles': 420}, {'filename': 'batch_B26T_cell_5.h5', 'cycles': 20, 'total_cycles': 219}, {'filename': 'batch_B26AA_cell_1.h5', 'cycles': 20, 'total_cycles': 219}, {'filename': 'batch_B26T_cell_4.h5', 'cycles': 20, 'total_cycles': 219}, {'filename': 'batch_B26AA_cell_4.h5', 'cycles': 20, 'total_cycles': 219}, {'filename': 'batch_B26K_cell_1.h5', 'cycles': 20, 'total_cycles': 221}, {'filename': 'batch_B26L_cell_1.h5', 'cycles': 20, 'total_cycles': 2028}, {'filename': 'batch_B26N_cell_1.h5', 'cycles': 20, 'total_cycles': 219}, {'filename': 'batch_B26O_cell_1.h5', 'cycles': 20, 'total_cycles': 219}, {'filename': 'batch_B26O_cell_4.h5', 'cycles': 20, 'total_cycles': 219}, {'filename': 'batch_B26O_cell_5.h5', 'cycles': 20, 'total_cycles': 219}, {'filename': 'batch_B26P_cell_3.h5', 'cycles': 20, 'total_cycles': 421}, {'filename': 'batch_B26P_cell_4.h5', 'cycles': 20, 'total_cycles': 420}, {'filename': 'batch_B26Q_cell_3.h5', 'cycles': 20, 'total_cycles': 219}, {'filename': 'batch_B26Q_cell_5.h5', 'cycles': 20, 'total_cycles': 219}, {'filename': 'batch_B26R_cell_1.h5', 'cycles': 20, 'total_cycles': 420}, {'filename': 'batch_B26R_cell_3.h5', 'cycles': 20, 'total_cycles': 420}, {'filename': 'batch_B26R_cell_4.h5', 'cycles': 20, 'total_cycles': 420}, {'filename': 'batch_B26S_cell_3.h5', 'cycles': 20, 'total_cycles': 420}, {'filename': 'batch_B26S_cell_4.h5', 'cycles': 20, 'total_cycles': 420}, {'filename': 'batch_B26S_cell_5.h5', 'cycles': 20, 'total_cycles': 219}, {'filename': 'batch_B5A_cell_7.h5', 'cycles': 20, 'total_cycles': 687}]}, 'target_val': {'5Vspinel': [{'filename': 'batch_B26K_cell_2.h5', 'cycles': 20, 'total_cycles': 221}, {'filename': 'batch_B26L_cell_2.h5', 'cycles': 20, 'total_cycles': 2028}, {'filename': 'batch_B26M_cell_2.h5', 'cycles': 20, 'total_cycles': 219}, {'filename': 'batch_B26P_cell_2.h5', 'cycles': 20, 'total_cycles': 420}, {'filename': 'batch_B26P_cell_6.h5', 'cycles': 20, 'total_cycles': 219}, {'filename': 'batch_B26R_cell_2.h5', 'cycles': 20, 'total_cycles': 420}, {'filename': 'batch_B26T_cell_2.h5', 'cycles': 20, 'total_cycles': 220}, {'filename': 'batch_B26V_cell_2.h5', 'cycles': 20, 'total_cycles': 421}, {'filename': 'batch_B26X_cell_2.h5', 'cycles': 20, 'total_cycles': 420}, {'filename': 'batch_B26Y_cell_2.h5', 'cycles': 20, 'total_cycles': 421}, {'filename': 'batch_B26Z_cell_2.h5', 'cycles': 20, 'total_cycles': 219}, {'filename': 'batch_B5A_cell_2.h5', 'cycles': 20, 'total_cycles': 820}]}}}
11-16 19:32:21 input_size: 32
11-16 19:32:21 reinit_head: False
11-16 19:32:21 using 1 cpu
11-16 19:32:21 Reducing learning rate to 5e-05 for 41 target samples
11-16 19:32:21 Freezing early layers of backbone for 41 target samples
11-16 19:32:21 Exception in callback functools.partial(<bound method OutStream._flush of <spyder_kernels.console.outstream.TTYOutStream object at 0x172cdca90>>)
Traceback (most recent call last):
  File "/Users/moondiab/opt/anaconda3/envs/venv/lib/python3.11/site-packages/jupyter_client/session.py", line 100, in json_packer
    ).encode("utf8", errors="surrogateescape")
      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
UnicodeEncodeError: 'utf-8' codec can't encode characters in position 1089-1090: surrogates not allowed

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/moondiab/opt/anaconda3/envs/venv/lib/python3.11/site-packages/tornado/ioloop.py", line 750, in _run_callback
    ret = callback()
          ^^^^^^^^^^
  File "/Users/moondiab/opt/anaconda3/envs/venv/lib/python3.11/site-packages/ipykernel/iostream.py", line 649, in _flush
    self.session.send(
  File "/Users/moondiab/opt/anaconda3/envs/venv/lib/python3.11/site-packages/jupyter_client/session.py", line 852, in send
    to_send = self.serialize(msg, ident)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/moondiab/opt/anaconda3/envs/venv/lib/python3.11/site-packages/jupyter_client/session.py", line 721, in serialize
    content = self.pack(content)
              ^^^^^^^^^^^^^^^^^^
  File "/Users/moondiab/opt/anaconda3/envs/venv/lib/python3.11/site-packages/jupyter_client/session.py", line 108, in json_packer
    ).encode("utf8", errors="surrogateescape")
      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
UnicodeEncodeError: 'utf-8' codec can't encode characters in position 1089-1090: surrogates not allowed
11-16 20:27:35 data_name: Battery_inconsistent
11-16 20:27:35 data_dir: ./my_datasets/Battery
11-16 20:27:35 csv: ./my_datasets/Battery/battery_cycles_labeled.csv
11-16 20:27:35 normlizetype: mean-std
11-16 20:27:35 method: sngp
11-16 20:27:35 gp_hidden_dim: 2048
11-16 20:27:35 spectral_norm_bound: 0.95
11-16 20:27:35 n_power_iterations: 1
11-16 20:27:35 nesterov: True
11-16 20:27:35 print_freq: 10
11-16 20:27:35 layers: 16
11-16 20:27:35 widen_factor: 1
11-16 20:27:35 droprate: 0.3
11-16 20:27:35 cuda_device: 0
11-16 20:27:35 checkpoint_dir: ./checkpoint
11-16 20:27:35 pretrained: True
11-16 20:27:35 batch_size: 64
11-16 20:27:35 num_workers: 0
11-16 20:27:35 bottleneck: True
11-16 20:27:35 bottleneck_num: 128
11-16 20:27:35 last_batch: False
11-16 20:27:35 hidden_size: 1024
11-16 20:27:35 trade_off_adversarial: Step
11-16 20:27:35 lam_adversarial: 1
11-16 20:27:35 opt: adam
11-16 20:27:35 lr: 5e-05
11-16 20:27:35 momentum: 0.9
11-16 20:27:35 weight_decay: 1e-05
11-16 20:27:35 lr_scheduler: step
11-16 20:27:35 gamma: 0.1
11-16 20:27:35 steps: 150, 250
11-16 20:27:35 middle_epoch: 15
11-16 20:27:35 max_epoch: 62
11-16 20:27:35 print_step: 25
11-16 20:27:35 inconsistent: UAN
11-16 20:27:35 model_name: WideResNet_sa
11-16 20:27:35 th: 0.5
11-16 20:27:35 input_channels: 22
11-16 20:27:35 classification_label: eol_class
11-16 20:27:35 sequence_length: 32
11-16 20:27:35 cycles_per_file: 5
11-16 20:27:35 sample_random_state: 42
11-16 20:27:35 transfer_task: [[0], [1]]
11-16 20:27:35 source_cathode: ['Li1.2Ni0.3Mn0.6O2', 'Li1.35Ni0.33Mn0.67O2.35']
11-16 20:27:35 target_cathode: ['5Vspinel']
11-16 20:27:35 num_classes: 5
11-16 20:27:35 domain_temperature: 1.0
11-16 20:27:35 class_temperature: 10.0
11-16 20:27:35 lambda_src: 0.0
11-16 20:27:35 lambda_src_decay_patience: 2
11-16 20:27:35 lambda_src_decay_factor: 0.5
11-16 20:27:35 lambda_src_min: 0.0
11-16 20:27:35 lambda_src_warmup: 0
11-16 20:27:35 improvement_metric: common
11-16 20:27:35 auto_select: True
11-16 20:27:35 llm_compare: True
11-16 20:27:35 llm_backend: openai
11-16 20:27:35 llm_model: None
11-16 20:27:35 llm_context: 
11-16 20:27:35 llm_cfg_inputs: {'text_context': "Dataset: Argonne National Laboratory battery aging time-series with partial cycle windows.\nSource cathodes: (all available); target cathodes: (none specified).\nLabel column 'eol_class' with ~None classes; sequence length 32; 7 channels covering cycle_number, energy_charge, capacity_charge, energy_discharge, capacity_discharge, cycle_start, cycle_duration.", 'numeric_summary': {'dataset': 'Battery_inconsistent', 'sequence_length_requested': 32, 'notes': 'label_inconsistent', 'lr_hint': 0.001, 'dropout_hint': 0.3, 'num_classes_hint': None, 'splits': {}, 'dataset_variant': 'argonne_battery', 'feature_names': ['cycle_number', 'energy_charge', 'capacity_charge', 'energy_discharge', 'capacity_discharge', 'cycle_start', 'cycle_duration'], 'source_cathodes': [], 'target_cathodes': [], 'label_column': 'eol_class'}}
11-16 20:27:35 llm_cfg: {'architecture': 'cnn_1d_sa', 'model_name': 'cnn_features_1d_sa', 'self_attention': True, 'sngp': True, 'openmax': False, 'use_unknown_head': False, 'bottleneck': 128, 'dropout': 0.3, 'learning_rate': 0.001, 'batch_size': 64, 'lambda_src': 0.0, 'rationale': 'The dataset has short sequences (32 steps) and 7 channels, making a 1-D CNN with self-attention ideal to capture local features and some long-range dependencies. Label inconsistency suggests avoiding openmax or unknown heads to reduce complexity and overfitting risk. Moderate bottleneck and dropout balance capacity and regularization. The learning rate and batch size align with hints for stable training on this battery dataset. Label inconsistency flagged → calibrated heads (SNGP/OpenMax) stay enabled for open-set robustness. Enabled SNGP to stabilise open-set transfer risk detected in metadata.', '_provider': 'openai', '_raw': '{\n  "model_name": "cnn_features_1d_sa",\n  "self_attention": true,\n  "sngp": false,\n  "openmax": false,\n  "use_unknown_head": false,\n  "bottleneck": 128,\n  "dropout": 0.3,\n  "learning_rate": 0.001,\n  "batch_size": 64,\n  "lambda_src": 0.0,\n  "rationale": "The dataset has short sequences (32 steps) and 7 channels, making a 1-D CNN with self-attention ideal to capture local features and some long-range dependencies. Label inconsistency suggests avoiding openmax or unknown heads to reduce complexity and overfitting risk. Moderate bottleneck and dropout balance capacity and regularization. The learning rate and batch size align with hints for stable training on this battery dataset."\n}'}
11-16 20:27:35 llm_cfg_stamp: 20251116_202238
11-16 20:27:35 tag: sngp_wrn_sa_20251116_202238
11-16 20:27:35 pretrained_model_path: ./checkpoint/transfer_WideResNet_sa_lirich_to_spinel5v_1116/best_model.pth
11-16 20:27:35 dataset_cycle_stats: {'source_train_cycles': 40, 'source_val_cycles': 10, 'source_val_has_holdout': True, 'target_train_cycles': 205, 'target_val_cycles': 60, 'target_val_has_holdout': True, 'source_train_sequences': 8, 'source_val_sequences': 2, 'target_train_sequences': 41, 'target_val_sequences': 12, 'source_train_cells': 6, 'source_val_cells': 2, 'target_train_cells': 5, 'target_val_cells': 2, 'cycles_per_cell_per_cathode': {'source_train': {'Li1.2Ni0.3Mn0.6O2': [{'filename': 'batch_B3A_cell_4.h5', 'cycles': 5, 'total_cycles': 181}, {'filename': 'batch_B3B_cell_1.h5', 'cycles': 5, 'total_cycles': 181}, {'filename': 'batch_B3B_cell_2.h5', 'cycles': 5, 'total_cycles': 181}, {'filename': 'batch_B3B_cell_3.h5', 'cycles': 5, 'total_cycles': 180}, {'filename': 'batch_B3B_cell_7.h5', 'cycles': 5, 'total_cycles': 180}], 'Li1.35Ni0.33Mn0.67O2.35': [{'filename': 'batch_B13A_cell_4.h5', 'cycles': 5, 'total_cycles': 169}, {'filename': 'batch_B13A_cell_8.h5', 'cycles': 5, 'total_cycles': 218}, {'filename': 'batch_B8A_cell_1.h5', 'cycles': 5, 'total_cycles': 214}]}, 'source_val': {'Li1.2Ni0.3Mn0.6O2': [{'filename': 'batch_B3B_cell_5.h5', 'cycles': 5, 'total_cycles': 180}], 'Li1.35Ni0.33Mn0.67O2.35': [{'filename': 'batch_B13A_cell_13.h5', 'cycles': 5, 'total_cycles': 218}]}, 'target_train': {'5Vspinel': [{'filename': 'batch_B11B_cell_4.h5', 'cycles': 5, 'total_cycles': 216}, {'filename': 'batch_B26U_cell_5.h5', 'cycles': 5, 'total_cycles': 219}, {'filename': 'batch_B26V_cell_3.h5', 'cycles': 5, 'total_cycles': 420}, {'filename': 'batch_B26V_cell_4.h5', 'cycles': 5, 'total_cycles': 420}, {'filename': 'batch_B26V_cell_5.h5', 'cycles': 5, 'total_cycles': 219}, {'filename': 'batch_B26W_cell_1.h5', 'cycles': 5, 'total_cycles': 420}, {'filename': 'batch_B26W_cell_3.h5', 'cycles': 5, 'total_cycles': 420}, {'filename': 'batch_B26W_cell_4.h5', 'cycles': 5, 'total_cycles': 420}, {'filename': 'batch_B26W_cell_5.h5', 'cycles': 5, 'total_cycles': 219}, {'filename': 'batch_B26X_cell_1.h5', 'cycles': 5, 'total_cycles': 420}, {'filename': 'batch_B26X_cell_3.h5', 'cycles': 5, 'total_cycles': 420}, {'filename': 'batch_B26X_cell_4.h5', 'cycles': 5, 'total_cycles': 420}, {'filename': 'batch_B26Y_cell_3.h5', 'cycles': 5, 'total_cycles': 420}, {'filename': 'batch_B26Y_cell_4.h5', 'cycles': 5, 'total_cycles': 420}, {'filename': 'batch_B26Y_cell_5.h5', 'cycles': 5, 'total_cycles': 219}, {'filename': 'batch_B26Z_cell_1.h5', 'cycles': 5, 'total_cycles': 219}, {'filename': 'batch_B26Z_cell_3.h5', 'cycles': 5, 'total_cycles': 219}, {'filename': 'batch_B5A_cell_1.h5', 'cycles': 5, 'total_cycles': 846}, {'filename': 'batch_B5A_cell_5.h5', 'cycles': 5, 'total_cycles': 855}, {'filename': 'batch_B26V_cell_1.h5', 'cycles': 5, 'total_cycles': 420}, {'filename': 'batch_B26T_cell_5.h5', 'cycles': 5, 'total_cycles': 219}, {'filename': 'batch_B26AA_cell_1.h5', 'cycles': 5, 'total_cycles': 219}, {'filename': 'batch_B26T_cell_4.h5', 'cycles': 5, 'total_cycles': 219}, {'filename': 'batch_B26AA_cell_4.h5', 'cycles': 5, 'total_cycles': 219}, {'filename': 'batch_B26K_cell_1.h5', 'cycles': 5, 'total_cycles': 221}, {'filename': 'batch_B26L_cell_1.h5', 'cycles': 5, 'total_cycles': 2028}, {'filename': 'batch_B26N_cell_1.h5', 'cycles': 5, 'total_cycles': 219}, {'filename': 'batch_B26O_cell_1.h5', 'cycles': 5, 'total_cycles': 219}, {'filename': 'batch_B26O_cell_4.h5', 'cycles': 5, 'total_cycles': 219}, {'filename': 'batch_B26O_cell_5.h5', 'cycles': 5, 'total_cycles': 219}, {'filename': 'batch_B26P_cell_3.h5', 'cycles': 5, 'total_cycles': 421}, {'filename': 'batch_B26P_cell_4.h5', 'cycles': 5, 'total_cycles': 420}, {'filename': 'batch_B26Q_cell_3.h5', 'cycles': 5, 'total_cycles': 219}, {'filename': 'batch_B26Q_cell_5.h5', 'cycles': 5, 'total_cycles': 219}, {'filename': 'batch_B26R_cell_1.h5', 'cycles': 5, 'total_cycles': 420}, {'filename': 'batch_B26R_cell_3.h5', 'cycles': 5, 'total_cycles': 420}, {'filename': 'batch_B26R_cell_4.h5', 'cycles': 5, 'total_cycles': 420}, {'filename': 'batch_B26S_cell_3.h5', 'cycles': 5, 'total_cycles': 420}, {'filename': 'batch_B26S_cell_4.h5', 'cycles': 5, 'total_cycles': 420}, {'filename': 'batch_B26S_cell_5.h5', 'cycles': 5, 'total_cycles': 219}, {'filename': 'batch_B5A_cell_7.h5', 'cycles': 5, 'total_cycles': 687}]}, 'target_val': {'5Vspinel': [{'filename': 'batch_B26K_cell_2.h5', 'cycles': 5, 'total_cycles': 221}, {'filename': 'batch_B26L_cell_2.h5', 'cycles': 5, 'total_cycles': 2028}, {'filename': 'batch_B26M_cell_2.h5', 'cycles': 5, 'total_cycles': 219}, {'filename': 'batch_B26P_cell_2.h5', 'cycles': 5, 'total_cycles': 420}, {'filename': 'batch_B26P_cell_6.h5', 'cycles': 5, 'total_cycles': 219}, {'filename': 'batch_B26R_cell_2.h5', 'cycles': 5, 'total_cycles': 420}, {'filename': 'batch_B26T_cell_2.h5', 'cycles': 5, 'total_cycles': 220}, {'filename': 'batch_B26V_cell_2.h5', 'cycles': 5, 'total_cycles': 421}, {'filename': 'batch_B26X_cell_2.h5', 'cycles': 5, 'total_cycles': 420}, {'filename': 'batch_B26Y_cell_2.h5', 'cycles': 5, 'total_cycles': 421}, {'filename': 'batch_B26Z_cell_2.h5', 'cycles': 5, 'total_cycles': 219}, {'filename': 'batch_B5A_cell_2.h5', 'cycles': 5, 'total_cycles': 820}]}}}
11-16 20:27:35 input_size: 32
11-16 20:27:35 reinit_head: False
11-16 20:27:35 using 1 cpu
11-16 20:27:35 Reducing learning rate to 5e-05 for 41 target samples
11-16 20:27:35 Freezing early layers of backbone for 41 target samples
11-16 20:27:35 Exception in callback functools.partial(<bound method OutStream._flush of <spyder_kernels.console.outstream.TTYOutStream object at 0x172cdca90>>)
Traceback (most recent call last):
  File "/Users/moondiab/opt/anaconda3/envs/venv/lib/python3.11/site-packages/jupyter_client/session.py", line 100, in json_packer
    ).encode("utf8", errors="surrogateescape")
      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
UnicodeEncodeError: 'utf-8' codec can't encode characters in position 1089-1090: surrogates not allowed

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/moondiab/opt/anaconda3/envs/venv/lib/python3.11/site-packages/tornado/ioloop.py", line 750, in _run_callback
    ret = callback()
          ^^^^^^^^^^
  File "/Users/moondiab/opt/anaconda3/envs/venv/lib/python3.11/site-packages/ipykernel/iostream.py", line 649, in _flush
    self.session.send(
  File "/Users/moondiab/opt/anaconda3/envs/venv/lib/python3.11/site-packages/jupyter_client/session.py", line 852, in send
    to_send = self.serialize(msg, ident)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/moondiab/opt/anaconda3/envs/venv/lib/python3.11/site-packages/jupyter_client/session.py", line 721, in serialize
    content = self.pack(content)
              ^^^^^^^^^^^^^^^^^^
  File "/Users/moondiab/opt/anaconda3/envs/venv/lib/python3.11/site-packages/jupyter_client/session.py", line 108, in json_packer
    ).encode("utf8", errors="surrogateescape")
      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
UnicodeEncodeError: 'utf-8' codec can't encode characters in position 1089-1090: surrogates not allowed
11-16 21:37:42 data_name: Battery_inconsistent
11-16 21:37:42 data_dir: ./my_datasets/Battery
11-16 21:37:42 csv: ./my_datasets/Battery/battery_cycles_labeled.csv
11-16 21:37:42 normlizetype: mean-std
11-16 21:37:42 method: sngp
11-16 21:37:42 gp_hidden_dim: 2048
11-16 21:37:42 spectral_norm_bound: 0.95
11-16 21:37:42 n_power_iterations: 1
11-16 21:37:42 nesterov: True
11-16 21:37:42 print_freq: 10
11-16 21:37:42 layers: 16
11-16 21:37:42 widen_factor: 1
11-16 21:37:42 droprate: 0.3
11-16 21:37:42 cuda_device: 0
11-16 21:37:42 checkpoint_dir: ./checkpoint
11-16 21:37:42 pretrained: True
11-16 21:37:42 batch_size: 64
11-16 21:37:42 num_workers: 0
11-16 21:37:42 bottleneck: True
11-16 21:37:42 bottleneck_num: 128
11-16 21:37:42 last_batch: False
11-16 21:37:42 hidden_size: 1024
11-16 21:37:42 trade_off_adversarial: Step
11-16 21:37:42 lam_adversarial: 1
11-16 21:37:42 opt: adam
11-16 21:37:42 lr: 5e-05
11-16 21:37:42 momentum: 0.9
11-16 21:37:42 weight_decay: 1e-05
11-16 21:37:42 lr_scheduler: step
11-16 21:37:42 gamma: 0.1
11-16 21:37:42 steps: 150, 250
11-16 21:37:42 middle_epoch: 15
11-16 21:37:42 max_epoch: 62
11-16 21:37:42 print_step: 25
11-16 21:37:42 inconsistent: UAN
11-16 21:37:42 model_name: WideResNet_sa
11-16 21:37:42 th: 0.5
11-16 21:37:42 input_channels: 21
11-16 21:37:42 classification_label: eol_class
11-16 21:37:42 sequence_length: 32
11-16 21:37:42 cycles_per_file: 5
11-16 21:37:42 sample_random_state: 42
11-16 21:37:42 transfer_task: [[0], [1]]
11-16 21:37:42 source_cathode: ['Li1.2Ni0.3Mn0.6O2', 'Li1.35Ni0.33Mn0.67O2.35']
11-16 21:37:42 target_cathode: ['5Vspinel']
11-16 21:37:42 num_classes: 5
11-16 21:37:42 domain_temperature: 1.0
11-16 21:37:42 class_temperature: 10.0
11-16 21:37:42 lambda_src: 0.0
11-16 21:37:42 lambda_src_decay_patience: 2
11-16 21:37:42 lambda_src_decay_factor: 0.5
11-16 21:37:42 lambda_src_min: 0.0
11-16 21:37:42 lambda_src_warmup: 0
11-16 21:37:42 improvement_metric: common
11-16 21:37:42 auto_select: True
11-16 21:37:42 llm_compare: True
11-16 21:37:42 llm_backend: openai
11-16 21:37:42 llm_model: None
11-16 21:37:42 llm_context: 
11-16 21:37:42 llm_cfg_inputs: {'text_context': "Dataset: Argonne National Laboratory battery aging time-series with partial cycle windows.\nSource cathodes: (all available); target cathodes: (none specified).\nLabel column 'eol_class' with ~None classes; sequence length 32; 7 channels covering cycle_number, energy_charge, capacity_charge, energy_discharge, capacity_discharge, cycle_start, cycle_duration.", 'numeric_summary': {'dataset': 'Battery_inconsistent', 'sequence_length_requested': 32, 'notes': 'label_inconsistent', 'lr_hint': 0.001, 'dropout_hint': 0.3, 'num_classes_hint': None, 'splits': {}, 'dataset_variant': 'argonne_battery', 'feature_names': ['cycle_number', 'energy_charge', 'capacity_charge', 'energy_discharge', 'capacity_discharge', 'cycle_start', 'cycle_duration'], 'source_cathodes': [], 'target_cathodes': [], 'label_column': 'eol_class'}}
11-16 21:37:42 llm_cfg: {'architecture': 'cnn_1d_sa', 'model_name': 'cnn_features_1d_sa', 'self_attention': True, 'sngp': True, 'openmax': False, 'use_unknown_head': False, 'bottleneck': 128, 'dropout': 0.3, 'learning_rate': 0.001, 'batch_size': 64, 'lambda_src': 0.0, 'rationale': 'The dataset has short sequences (32 steps) and 7 channels, suitable for a 1-D CNN with self-attention to capture local and some longer-range dependencies. Label inconsistency suggests avoiding openmax or unknown heads to reduce complexity and tuning overhead. Dropout at 0.3 balances overfitting risk given the small sequence length and label noise. Batch size 64 and learning rate 0.001 align with typical stable training for this domain. Label inconsistency flagged → calibrated heads (SNGP/OpenMax) stay enabled for open-set robustness. Enabled SNGP to stabilise open-set transfer risk detected in metadata.', '_provider': 'openai', '_raw': '{\n  "model_name": "cnn_features_1d_sa",\n  "self_attention": true,\n  "sngp": false,\n  "openmax": false,\n  "use_unknown_head": false,\n  "bottleneck": 128,\n  "dropout": 0.3,\n  "learning_rate": 0.001,\n  "batch_size": 64,\n  "lambda_src": 0.0,\n  "rationale": "The dataset has short sequences (32 steps) and 7 channels, suitable for a 1-D CNN with self-attention to capture local and some longer-range dependencies. Label inconsistency suggests avoiding openmax or unknown heads to reduce complexity and tuning overhead. Dropout at 0.3 balances overfitting risk given the small sequence length and label noise. Batch size 64 and learning rate 0.001 align with typical stable training for this domain."\n}'}
11-16 21:37:42 llm_cfg_stamp: 20251116_213306
11-16 21:37:42 tag: sngp_wrn_sa_20251116_213306
11-16 21:37:42 pretrained_model_path: ./checkpoint/transfer_WideResNet_sa_lirich_to_spinel5v_1116/best_model.pth
11-16 21:37:42 dataset_cycle_stats: {'source_train_cycles': 40, 'source_val_cycles': 10, 'source_val_has_holdout': True, 'target_train_cycles': 205, 'target_val_cycles': 60, 'target_val_has_holdout': True, 'source_train_sequences': 8, 'source_val_sequences': 2, 'target_train_sequences': 41, 'target_val_sequences': 12, 'source_train_cells': 6, 'source_val_cells': 2, 'target_train_cells': 5, 'target_val_cells': 2, 'cycles_per_cell_per_cathode': {'source_train': {'Li1.2Ni0.3Mn0.6O2': [{'filename': 'batch_B3A_cell_4.h5', 'cycles': 5, 'total_cycles': 181}, {'filename': 'batch_B3B_cell_1.h5', 'cycles': 5, 'total_cycles': 181}, {'filename': 'batch_B3B_cell_2.h5', 'cycles': 5, 'total_cycles': 181}, {'filename': 'batch_B3B_cell_3.h5', 'cycles': 5, 'total_cycles': 180}, {'filename': 'batch_B3B_cell_7.h5', 'cycles': 5, 'total_cycles': 180}], 'Li1.35Ni0.33Mn0.67O2.35': [{'filename': 'batch_B13A_cell_4.h5', 'cycles': 5, 'total_cycles': 169}, {'filename': 'batch_B13A_cell_8.h5', 'cycles': 5, 'total_cycles': 218}, {'filename': 'batch_B8A_cell_1.h5', 'cycles': 5, 'total_cycles': 214}]}, 'source_val': {'Li1.2Ni0.3Mn0.6O2': [{'filename': 'batch_B3B_cell_5.h5', 'cycles': 5, 'total_cycles': 180}], 'Li1.35Ni0.33Mn0.67O2.35': [{'filename': 'batch_B13A_cell_13.h5', 'cycles': 5, 'total_cycles': 218}]}, 'target_train': {'5Vspinel': [{'filename': 'batch_B11B_cell_4.h5', 'cycles': 5, 'total_cycles': 216}, {'filename': 'batch_B26U_cell_5.h5', 'cycles': 5, 'total_cycles': 219}, {'filename': 'batch_B26V_cell_3.h5', 'cycles': 5, 'total_cycles': 420}, {'filename': 'batch_B26V_cell_4.h5', 'cycles': 5, 'total_cycles': 420}, {'filename': 'batch_B26V_cell_5.h5', 'cycles': 5, 'total_cycles': 219}, {'filename': 'batch_B26W_cell_1.h5', 'cycles': 5, 'total_cycles': 420}, {'filename': 'batch_B26W_cell_3.h5', 'cycles': 5, 'total_cycles': 420}, {'filename': 'batch_B26W_cell_4.h5', 'cycles': 5, 'total_cycles': 420}, {'filename': 'batch_B26W_cell_5.h5', 'cycles': 5, 'total_cycles': 219}, {'filename': 'batch_B26X_cell_1.h5', 'cycles': 5, 'total_cycles': 420}, {'filename': 'batch_B26X_cell_3.h5', 'cycles': 5, 'total_cycles': 420}, {'filename': 'batch_B26X_cell_4.h5', 'cycles': 5, 'total_cycles': 420}, {'filename': 'batch_B26Y_cell_3.h5', 'cycles': 5, 'total_cycles': 420}, {'filename': 'batch_B26Y_cell_4.h5', 'cycles': 5, 'total_cycles': 420}, {'filename': 'batch_B26Y_cell_5.h5', 'cycles': 5, 'total_cycles': 219}, {'filename': 'batch_B26Z_cell_1.h5', 'cycles': 5, 'total_cycles': 219}, {'filename': 'batch_B26Z_cell_3.h5', 'cycles': 5, 'total_cycles': 219}, {'filename': 'batch_B5A_cell_1.h5', 'cycles': 5, 'total_cycles': 846}, {'filename': 'batch_B5A_cell_5.h5', 'cycles': 5, 'total_cycles': 855}, {'filename': 'batch_B26V_cell_1.h5', 'cycles': 5, 'total_cycles': 420}, {'filename': 'batch_B26T_cell_5.h5', 'cycles': 5, 'total_cycles': 219}, {'filename': 'batch_B26AA_cell_1.h5', 'cycles': 5, 'total_cycles': 219}, {'filename': 'batch_B26T_cell_4.h5', 'cycles': 5, 'total_cycles': 219}, {'filename': 'batch_B26AA_cell_4.h5', 'cycles': 5, 'total_cycles': 219}, {'filename': 'batch_B26K_cell_1.h5', 'cycles': 5, 'total_cycles': 221}, {'filename': 'batch_B26L_cell_1.h5', 'cycles': 5, 'total_cycles': 2028}, {'filename': 'batch_B26N_cell_1.h5', 'cycles': 5, 'total_cycles': 219}, {'filename': 'batch_B26O_cell_1.h5', 'cycles': 5, 'total_cycles': 219}, {'filename': 'batch_B26O_cell_4.h5', 'cycles': 5, 'total_cycles': 219}, {'filename': 'batch_B26O_cell_5.h5', 'cycles': 5, 'total_cycles': 219}, {'filename': 'batch_B26P_cell_3.h5', 'cycles': 5, 'total_cycles': 421}, {'filename': 'batch_B26P_cell_4.h5', 'cycles': 5, 'total_cycles': 420}, {'filename': 'batch_B26Q_cell_3.h5', 'cycles': 5, 'total_cycles': 219}, {'filename': 'batch_B26Q_cell_5.h5', 'cycles': 5, 'total_cycles': 219}, {'filename': 'batch_B26R_cell_1.h5', 'cycles': 5, 'total_cycles': 420}, {'filename': 'batch_B26R_cell_3.h5', 'cycles': 5, 'total_cycles': 420}, {'filename': 'batch_B26R_cell_4.h5', 'cycles': 5, 'total_cycles': 420}, {'filename': 'batch_B26S_cell_3.h5', 'cycles': 5, 'total_cycles': 420}, {'filename': 'batch_B26S_cell_4.h5', 'cycles': 5, 'total_cycles': 420}, {'filename': 'batch_B26S_cell_5.h5', 'cycles': 5, 'total_cycles': 219}, {'filename': 'batch_B5A_cell_7.h5', 'cycles': 5, 'total_cycles': 687}]}, 'target_val': {'5Vspinel': [{'filename': 'batch_B26K_cell_2.h5', 'cycles': 5, 'total_cycles': 221}, {'filename': 'batch_B26L_cell_2.h5', 'cycles': 5, 'total_cycles': 2028}, {'filename': 'batch_B26M_cell_2.h5', 'cycles': 5, 'total_cycles': 219}, {'filename': 'batch_B26P_cell_2.h5', 'cycles': 5, 'total_cycles': 420}, {'filename': 'batch_B26P_cell_6.h5', 'cycles': 5, 'total_cycles': 219}, {'filename': 'batch_B26R_cell_2.h5', 'cycles': 5, 'total_cycles': 420}, {'filename': 'batch_B26T_cell_2.h5', 'cycles': 5, 'total_cycles': 220}, {'filename': 'batch_B26V_cell_2.h5', 'cycles': 5, 'total_cycles': 421}, {'filename': 'batch_B26X_cell_2.h5', 'cycles': 5, 'total_cycles': 420}, {'filename': 'batch_B26Y_cell_2.h5', 'cycles': 5, 'total_cycles': 421}, {'filename': 'batch_B26Z_cell_2.h5', 'cycles': 5, 'total_cycles': 219}, {'filename': 'batch_B5A_cell_2.h5', 'cycles': 5, 'total_cycles': 820}]}}, 'feature_columns': ('cycle_number', 'energy_charge', 'capacity_charge', 'energy_discharge', 'capacity_discharge', 'cycle_start', 'cycle_duration', 'capacity_retention', 'energy_retention', 'delta_capacity_discharge', 'delta_energy_discharge', 'delta_cycle_duration', 'rolling_capacity_mean', 'rolling_capacity_std', 'rolling_energy_mean', 'rolling_energy_std', 'rolling_duration_mean', 'duration_ratio', 'coulombic_efficiency', 'energy_efficiency', 'time_per_capacity')}
11-16 21:37:42 input_size: 32
11-16 21:37:42 reinit_head: False
11-16 21:37:42 using 1 cpu
11-16 21:37:42 Reducing learning rate to 5e-05 for 41 target samples
11-16 21:37:42 Freezing early layers of backbone for 41 target samples
11-16 21:37:42 Exception in callback functools.partial(<bound method OutStream._flush of <spyder_kernels.console.outstream.TTYOutStream object at 0x172cdca90>>)
Traceback (most recent call last):
  File "/Users/moondiab/opt/anaconda3/envs/venv/lib/python3.11/site-packages/jupyter_client/session.py", line 100, in json_packer
    ).encode("utf8", errors="surrogateescape")
      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
UnicodeEncodeError: 'utf-8' codec can't encode characters in position 28-29: surrogates not allowed

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/moondiab/opt/anaconda3/envs/venv/lib/python3.11/site-packages/tornado/ioloop.py", line 750, in _run_callback
    ret = callback()
          ^^^^^^^^^^
  File "/Users/moondiab/opt/anaconda3/envs/venv/lib/python3.11/site-packages/ipykernel/iostream.py", line 649, in _flush
    self.session.send(
  File "/Users/moondiab/opt/anaconda3/envs/venv/lib/python3.11/site-packages/jupyter_client/session.py", line 852, in send
    to_send = self.serialize(msg, ident)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/moondiab/opt/anaconda3/envs/venv/lib/python3.11/site-packages/jupyter_client/session.py", line 721, in serialize
    content = self.pack(content)
              ^^^^^^^^^^^^^^^^^^
  File "/Users/moondiab/opt/anaconda3/envs/venv/lib/python3.11/site-packages/jupyter_client/session.py", line 108, in json_packer
    ).encode("utf8", errors="surrogateescape")
      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
UnicodeEncodeError: 'utf-8' codec can't encode characters in position 28-29: surrogates not allowed
11-16 22:25:20 data_name: Battery_inconsistent
11-16 22:25:20 data_dir: ./my_datasets/Battery
11-16 22:25:20 csv: ./my_datasets/Battery/battery_cycles_labeled.csv
11-16 22:25:20 normlizetype: mean-std
11-16 22:25:20 method: sngp
11-16 22:25:20 gp_hidden_dim: 2048
11-16 22:25:20 spectral_norm_bound: 0.95
11-16 22:25:20 n_power_iterations: 1
11-16 22:25:20 nesterov: True
11-16 22:25:20 print_freq: 10
11-16 22:25:20 layers: 16
11-16 22:25:20 widen_factor: 1
11-16 22:25:20 droprate: 0.3
11-16 22:25:20 cuda_device: 0
11-16 22:25:20 checkpoint_dir: ./checkpoint
11-16 22:25:20 pretrained: True
11-16 22:25:20 batch_size: 64
11-16 22:25:20 num_workers: 0
11-16 22:25:20 bottleneck: True
11-16 22:25:20 bottleneck_num: 128
11-16 22:25:20 last_batch: False
11-16 22:25:20 hidden_size: 1024
11-16 22:25:20 trade_off_adversarial: Step
11-16 22:25:20 lam_adversarial: 1
11-16 22:25:20 opt: adam
11-16 22:25:20 lr: 5e-05
11-16 22:25:20 momentum: 0.9
11-16 22:25:20 weight_decay: 1e-05
11-16 22:25:20 lr_scheduler: step
11-16 22:25:20 gamma: 0.1
11-16 22:25:20 steps: 150, 250
11-16 22:25:20 middle_epoch: 15
11-16 22:25:20 max_epoch: 62
11-16 22:25:20 print_step: 25
11-16 22:25:20 inconsistent: UAN
11-16 22:25:20 model_name: WideResNet_sa
11-16 22:25:20 th: 0.5
11-16 22:25:20 input_channels: 21
11-16 22:25:20 classification_label: eol_class
11-16 22:25:20 sequence_length: 32
11-16 22:25:20 cycles_per_file: 5
11-16 22:25:20 sample_random_state: 42
11-16 22:25:20 transfer_task: [[0], [1]]
11-16 22:25:20 source_cathode: ['Li1.2Ni0.3Mn0.6O2', 'Li1.35Ni0.33Mn0.67O2.35']
11-16 22:25:20 target_cathode: ['5Vspinel']
11-16 22:25:20 num_classes: 5
11-16 22:25:20 domain_temperature: 1.0
11-16 22:25:20 class_temperature: 10.0
11-16 22:25:20 lambda_src: 0.0
11-16 22:25:20 lambda_src_decay_patience: 2
11-16 22:25:20 lambda_src_decay_factor: 0.5
11-16 22:25:20 lambda_src_min: 0.0
11-16 22:25:20 lambda_src_warmup: 0
11-16 22:25:20 improvement_metric: common
11-16 22:25:20 auto_select: True
11-16 22:25:20 llm_compare: True
11-16 22:25:20 llm_backend: openai
11-16 22:25:20 llm_model: None
11-16 22:25:20 llm_context: 
11-16 22:25:20 llm_cfg_inputs: {'text_context': "Dataset: Argonne National Laboratory battery aging time-series with partial cycle windows.\nSource cathodes: (all available); target cathodes: (none specified).\nLabel column 'eol_class' with ~None classes; sequence length 32; 7 channels covering cycle_number, energy_charge, capacity_charge, energy_discharge, capacity_discharge, cycle_start, cycle_duration.", 'numeric_summary': {'dataset': 'Battery_inconsistent', 'sequence_length_requested': 32, 'notes': 'label_inconsistent', 'lr_hint': 0.001, 'dropout_hint': 0.3, 'num_classes_hint': None, 'splits': {}, 'dataset_variant': 'argonne_battery', 'feature_names': ['cycle_number', 'energy_charge', 'capacity_charge', 'energy_discharge', 'capacity_discharge', 'cycle_start', 'cycle_duration'], 'source_cathodes': [], 'target_cathodes': [], 'label_column': 'eol_class'}}
11-16 22:25:20 llm_cfg: {'architecture': 'cnn_1d_sa', 'model_name': 'cnn_features_1d_sa', 'self_attention': True, 'sngp': True, 'openmax': False, 'use_unknown_head': False, 'bottleneck': 128, 'dropout': 0.3, 'learning_rate': 0.001, 'batch_size': 64, 'lambda_src': 0.0, 'rationale': 'The dataset has short sequences (32 steps) and 7 channels, making a 1-D CNN with self-attention suitable to capture local and some longer-range dependencies without excessive compute. Label inconsistency suggests avoiding openmax or unknown heads to reduce tuning complexity. Dropout at 0.3 balances overfitting risk due to label noise. Batch size 64 and learning rate 0.001 align with hints and stable training. Label inconsistency flagged → calibrated heads (SNGP/OpenMax) stay enabled for open-set robustness. Enabled SNGP to stabilise open-set transfer risk detected in metadata.', '_provider': 'openai', '_raw': '{\n  "model_name": "cnn_features_1d_sa",\n  "self_attention": true,\n  "sngp": false,\n  "openmax": false,\n  "use_unknown_head": false,\n  "bottleneck": 128,\n  "dropout": 0.3,\n  "learning_rate": 0.001,\n  "batch_size": 64,\n  "lambda_src": 0.0,\n  "rationale": "The dataset has short sequences (32 steps) and 7 channels, making a 1-D CNN with self-attention suitable to capture local and some longer-range dependencies without excessive compute. Label inconsistency suggests avoiding openmax or unknown heads to reduce tuning complexity. Dropout at 0.3 balances overfitting risk due to label noise. Batch size 64 and learning rate 0.001 align with hints and stable training."\n}'}
11-16 22:25:20 llm_cfg_stamp: 20251116_222040
11-16 22:25:20 tag: sngp_wrn_sa_20251116_222040
11-16 22:25:20 pretrained_model_path: ./checkpoint/transfer_WideResNet_sa_lirich_to_spinel5v_1116/best_model.pth
11-16 22:25:20 dataset_cycle_stats: {'source_train_cycles': 40, 'source_val_cycles': 10, 'source_val_has_holdout': True, 'target_train_cycles': 205, 'target_val_cycles': 60, 'target_val_has_holdout': True, 'source_train_sequences': 8, 'source_val_sequences': 2, 'target_train_sequences': 41, 'target_val_sequences': 12, 'source_train_cells': 6, 'source_val_cells': 2, 'target_train_cells': 5, 'target_val_cells': 2, 'cycles_per_cell_per_cathode': {'source_train': {'Li1.2Ni0.3Mn0.6O2': [{'filename': 'batch_B3A_cell_4.h5', 'cycles': 5, 'total_cycles': 181}, {'filename': 'batch_B3B_cell_1.h5', 'cycles': 5, 'total_cycles': 181}, {'filename': 'batch_B3B_cell_2.h5', 'cycles': 5, 'total_cycles': 181}, {'filename': 'batch_B3B_cell_3.h5', 'cycles': 5, 'total_cycles': 180}, {'filename': 'batch_B3B_cell_7.h5', 'cycles': 5, 'total_cycles': 180}], 'Li1.35Ni0.33Mn0.67O2.35': [{'filename': 'batch_B13A_cell_4.h5', 'cycles': 5, 'total_cycles': 169}, {'filename': 'batch_B13A_cell_8.h5', 'cycles': 5, 'total_cycles': 218}, {'filename': 'batch_B8A_cell_1.h5', 'cycles': 5, 'total_cycles': 214}]}, 'source_val': {'Li1.2Ni0.3Mn0.6O2': [{'filename': 'batch_B3B_cell_5.h5', 'cycles': 5, 'total_cycles': 180}], 'Li1.35Ni0.33Mn0.67O2.35': [{'filename': 'batch_B13A_cell_13.h5', 'cycles': 5, 'total_cycles': 218}]}, 'target_train': {'5Vspinel': [{'filename': 'batch_B11B_cell_4.h5', 'cycles': 5, 'total_cycles': 216}, {'filename': 'batch_B26U_cell_5.h5', 'cycles': 5, 'total_cycles': 219}, {'filename': 'batch_B26V_cell_3.h5', 'cycles': 5, 'total_cycles': 420}, {'filename': 'batch_B26V_cell_4.h5', 'cycles': 5, 'total_cycles': 420}, {'filename': 'batch_B26V_cell_5.h5', 'cycles': 5, 'total_cycles': 219}, {'filename': 'batch_B26W_cell_1.h5', 'cycles': 5, 'total_cycles': 420}, {'filename': 'batch_B26W_cell_3.h5', 'cycles': 5, 'total_cycles': 420}, {'filename': 'batch_B26W_cell_4.h5', 'cycles': 5, 'total_cycles': 420}, {'filename': 'batch_B26W_cell_5.h5', 'cycles': 5, 'total_cycles': 219}, {'filename': 'batch_B26X_cell_1.h5', 'cycles': 5, 'total_cycles': 420}, {'filename': 'batch_B26X_cell_3.h5', 'cycles': 5, 'total_cycles': 420}, {'filename': 'batch_B26X_cell_4.h5', 'cycles': 5, 'total_cycles': 420}, {'filename': 'batch_B26Y_cell_3.h5', 'cycles': 5, 'total_cycles': 420}, {'filename': 'batch_B26Y_cell_4.h5', 'cycles': 5, 'total_cycles': 420}, {'filename': 'batch_B26Y_cell_5.h5', 'cycles': 5, 'total_cycles': 219}, {'filename': 'batch_B26Z_cell_1.h5', 'cycles': 5, 'total_cycles': 219}, {'filename': 'batch_B26Z_cell_3.h5', 'cycles': 5, 'total_cycles': 219}, {'filename': 'batch_B5A_cell_1.h5', 'cycles': 5, 'total_cycles': 846}, {'filename': 'batch_B5A_cell_5.h5', 'cycles': 5, 'total_cycles': 855}, {'filename': 'batch_B26V_cell_1.h5', 'cycles': 5, 'total_cycles': 420}, {'filename': 'batch_B26T_cell_5.h5', 'cycles': 5, 'total_cycles': 219}, {'filename': 'batch_B26AA_cell_1.h5', 'cycles': 5, 'total_cycles': 219}, {'filename': 'batch_B26T_cell_4.h5', 'cycles': 5, 'total_cycles': 219}, {'filename': 'batch_B26AA_cell_4.h5', 'cycles': 5, 'total_cycles': 219}, {'filename': 'batch_B26K_cell_1.h5', 'cycles': 5, 'total_cycles': 221}, {'filename': 'batch_B26L_cell_1.h5', 'cycles': 5, 'total_cycles': 2028}, {'filename': 'batch_B26N_cell_1.h5', 'cycles': 5, 'total_cycles': 219}, {'filename': 'batch_B26O_cell_1.h5', 'cycles': 5, 'total_cycles': 219}, {'filename': 'batch_B26O_cell_4.h5', 'cycles': 5, 'total_cycles': 219}, {'filename': 'batch_B26O_cell_5.h5', 'cycles': 5, 'total_cycles': 219}, {'filename': 'batch_B26P_cell_3.h5', 'cycles': 5, 'total_cycles': 421}, {'filename': 'batch_B26P_cell_4.h5', 'cycles': 5, 'total_cycles': 420}, {'filename': 'batch_B26Q_cell_3.h5', 'cycles': 5, 'total_cycles': 219}, {'filename': 'batch_B26Q_cell_5.h5', 'cycles': 5, 'total_cycles': 219}, {'filename': 'batch_B26R_cell_1.h5', 'cycles': 5, 'total_cycles': 420}, {'filename': 'batch_B26R_cell_3.h5', 'cycles': 5, 'total_cycles': 420}, {'filename': 'batch_B26R_cell_4.h5', 'cycles': 5, 'total_cycles': 420}, {'filename': 'batch_B26S_cell_3.h5', 'cycles': 5, 'total_cycles': 420}, {'filename': 'batch_B26S_cell_4.h5', 'cycles': 5, 'total_cycles': 420}, {'filename': 'batch_B26S_cell_5.h5', 'cycles': 5, 'total_cycles': 219}, {'filename': 'batch_B5A_cell_7.h5', 'cycles': 5, 'total_cycles': 687}]}, 'target_val': {'5Vspinel': [{'filename': 'batch_B26K_cell_2.h5', 'cycles': 5, 'total_cycles': 221}, {'filename': 'batch_B26L_cell_2.h5', 'cycles': 5, 'total_cycles': 2028}, {'filename': 'batch_B26M_cell_2.h5', 'cycles': 5, 'total_cycles': 219}, {'filename': 'batch_B26P_cell_2.h5', 'cycles': 5, 'total_cycles': 420}, {'filename': 'batch_B26P_cell_6.h5', 'cycles': 5, 'total_cycles': 219}, {'filename': 'batch_B26R_cell_2.h5', 'cycles': 5, 'total_cycles': 420}, {'filename': 'batch_B26T_cell_2.h5', 'cycles': 5, 'total_cycles': 220}, {'filename': 'batch_B26V_cell_2.h5', 'cycles': 5, 'total_cycles': 421}, {'filename': 'batch_B26X_cell_2.h5', 'cycles': 5, 'total_cycles': 420}, {'filename': 'batch_B26Y_cell_2.h5', 'cycles': 5, 'total_cycles': 421}, {'filename': 'batch_B26Z_cell_2.h5', 'cycles': 5, 'total_cycles': 219}, {'filename': 'batch_B5A_cell_2.h5', 'cycles': 5, 'total_cycles': 820}]}}, 'feature_columns': ('cycle_number', 'energy_charge', 'capacity_charge', 'energy_discharge', 'capacity_discharge', 'cycle_start', 'cycle_duration', 'capacity_retention', 'energy_retention', 'delta_capacity_discharge', 'delta_energy_discharge', 'delta_cycle_duration', 'rolling_capacity_mean', 'rolling_capacity_std', 'rolling_energy_mean', 'rolling_energy_std', 'rolling_duration_mean', 'duration_ratio', 'coulombic_efficiency', 'energy_efficiency', 'time_per_capacity')}
11-16 22:25:20 input_size: 32
11-16 22:25:20 reinit_head: False
11-16 22:25:20 using 1 cpu
11-16 22:25:20 Reducing learning rate to 5e-05 for 41 target samples
11-16 22:25:20 Freezing early layers of backbone for 41 target samples
11-16 22:25:20 Uncaught exception in ZMQStream callback
Traceback (most recent call last):
  File "/Users/moondiab/opt/anaconda3/envs/venv/lib/python3.11/site-packages/jupyter_client/session.py", line 100, in json_packer
    ).encode("utf8", errors="surrogateescape")
      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
UnicodeEncodeError: 'utf-8' codec can't encode characters in position 28-29: surrogates not allowed

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/moondiab/opt/anaconda3/envs/venv/lib/python3.11/site-packages/zmq/eventloop/zmqstream.py", line 560, in _run_callback
    f = callback(*args, **kwargs)
        ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/moondiab/opt/anaconda3/envs/venv/lib/python3.11/site-packages/ipykernel/iostream.py", line 170, in _handle_event
    event_f()
  File "/Users/moondiab/opt/anaconda3/envs/venv/lib/python3.11/site-packages/ipykernel/iostream.py", line 649, in _flush
    self.session.send(
  File "/Users/moondiab/opt/anaconda3/envs/venv/lib/python3.11/site-packages/jupyter_client/session.py", line 852, in send
    to_send = self.serialize(msg, ident)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/moondiab/opt/anaconda3/envs/venv/lib/python3.11/site-packages/jupyter_client/session.py", line 721, in serialize
    content = self.pack(content)
              ^^^^^^^^^^^^^^^^^^
  File "/Users/moondiab/opt/anaconda3/envs/venv/lib/python3.11/site-packages/jupyter_client/session.py", line 108, in json_packer
    ).encode("utf8", errors="surrogateescape")
      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
UnicodeEncodeError: 'utf-8' codec can't encode characters in position 28-29: surrogates not allowed
11-16 22:25:20 Uncaught exception in zmqstream callback
Traceback (most recent call last):
  File "/Users/moondiab/opt/anaconda3/envs/venv/lib/python3.11/site-packages/jupyter_client/session.py", line 100, in json_packer
    ).encode("utf8", errors="surrogateescape")
      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
UnicodeEncodeError: 'utf-8' codec can't encode characters in position 28-29: surrogates not allowed

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/moondiab/opt/anaconda3/envs/venv/lib/python3.11/site-packages/zmq/eventloop/zmqstream.py", line 610, in _handle_events
    self._handle_recv()
  File "/Users/moondiab/opt/anaconda3/envs/venv/lib/python3.11/site-packages/zmq/eventloop/zmqstream.py", line 639, in _handle_recv
    self._run_callback(callback, msg)
  File "/Users/moondiab/opt/anaconda3/envs/venv/lib/python3.11/site-packages/zmq/eventloop/zmqstream.py", line 560, in _run_callback
    f = callback(*args, **kwargs)
        ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/moondiab/opt/anaconda3/envs/venv/lib/python3.11/site-packages/ipykernel/iostream.py", line 170, in _handle_event
    event_f()
  File "/Users/moondiab/opt/anaconda3/envs/venv/lib/python3.11/site-packages/ipykernel/iostream.py", line 649, in _flush
    self.session.send(
  File "/Users/moondiab/opt/anaconda3/envs/venv/lib/python3.11/site-packages/jupyter_client/session.py", line 852, in send
    to_send = self.serialize(msg, ident)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/moondiab/opt/anaconda3/envs/venv/lib/python3.11/site-packages/jupyter_client/session.py", line 721, in serialize
    content = self.pack(content)
              ^^^^^^^^^^^^^^^^^^
  File "/Users/moondiab/opt/anaconda3/envs/venv/lib/python3.11/site-packages/jupyter_client/session.py", line 108, in json_packer
    ).encode("utf8", errors="surrogateescape")
      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
UnicodeEncodeError: 'utf-8' codec can't encode characters in position 28-29: surrogates not allowed
11-16 22:25:20 Exception in callback BaseAsyncIOLoop._handle_events(43, 1)
handle: <Handle BaseAsyncIOLoop._handle_events(43, 1)>
Traceback (most recent call last):
  File "/Users/moondiab/opt/anaconda3/envs/venv/lib/python3.11/site-packages/jupyter_client/session.py", line 100, in json_packer
    ).encode("utf8", errors="surrogateescape")
      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
UnicodeEncodeError: 'utf-8' codec can't encode characters in position 28-29: surrogates not allowed

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/moondiab/opt/anaconda3/envs/venv/lib/python3.11/asyncio/events.py", line 84, in _run
    self._context.run(self._callback, *self._args)
  File "/Users/moondiab/opt/anaconda3/envs/venv/lib/python3.11/site-packages/tornado/platform/asyncio.py", line 202, in _handle_events
    handler_func(fileobj, events)
  File "/Users/moondiab/opt/anaconda3/envs/venv/lib/python3.11/site-packages/zmq/eventloop/zmqstream.py", line 610, in _handle_events
    self._handle_recv()
  File "/Users/moondiab/opt/anaconda3/envs/venv/lib/python3.11/site-packages/zmq/eventloop/zmqstream.py", line 639, in _handle_recv
    self._run_callback(callback, msg)
  File "/Users/moondiab/opt/anaconda3/envs/venv/lib/python3.11/site-packages/zmq/eventloop/zmqstream.py", line 560, in _run_callback
    f = callback(*args, **kwargs)
        ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/moondiab/opt/anaconda3/envs/venv/lib/python3.11/site-packages/ipykernel/iostream.py", line 170, in _handle_event
    event_f()
  File "/Users/moondiab/opt/anaconda3/envs/venv/lib/python3.11/site-packages/ipykernel/iostream.py", line 649, in _flush
    self.session.send(
  File "/Users/moondiab/opt/anaconda3/envs/venv/lib/python3.11/site-packages/jupyter_client/session.py", line 852, in send
    to_send = self.serialize(msg, ident)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/moondiab/opt/anaconda3/envs/venv/lib/python3.11/site-packages/jupyter_client/session.py", line 721, in serialize
    content = self.pack(content)
              ^^^^^^^^^^^^^^^^^^
  File "/Users/moondiab/opt/anaconda3/envs/venv/lib/python3.11/site-packages/jupyter_client/session.py", line 108, in json_packer
    ).encode("utf8", errors="surrogateescape")
      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
UnicodeEncodeError: 'utf-8' codec can't encode characters in position 28-29: surrogates not allowed
11-16 22:59:40 data_name: Battery_inconsistent
11-16 22:59:40 data_dir: ./my_datasets/Battery
11-16 22:59:40 csv: ./my_datasets/Battery/battery_cycles_labeled.csv
11-16 22:59:40 normlizetype: mean-std
11-16 22:59:40 method: sngp
11-16 22:59:40 gp_hidden_dim: 2048
11-16 22:59:40 spectral_norm_bound: 0.95
11-16 22:59:40 n_power_iterations: 1
11-16 22:59:40 nesterov: True
11-16 22:59:40 print_freq: 10
11-16 22:59:40 layers: 16
11-16 22:59:40 widen_factor: 1
11-16 22:59:40 droprate: 0.3
11-16 22:59:40 cuda_device: 0
11-16 22:59:40 checkpoint_dir: ./checkpoint
11-16 22:59:40 pretrained: True
11-16 22:59:40 batch_size: 64
11-16 22:59:40 num_workers: 0
11-16 22:59:40 bottleneck: True
11-16 22:59:40 bottleneck_num: 128
11-16 22:59:40 last_batch: False
11-16 22:59:40 hidden_size: 1024
11-16 22:59:40 trade_off_adversarial: Step
11-16 22:59:40 lam_adversarial: 1
11-16 22:59:40 opt: adam
11-16 22:59:40 lr: 5e-05
11-16 22:59:40 momentum: 0.9
11-16 22:59:40 weight_decay: 1e-05
11-16 22:59:40 lr_scheduler: step
11-16 22:59:40 gamma: 0.1
11-16 22:59:40 steps: 150, 250
11-16 22:59:40 middle_epoch: 15
11-16 22:59:40 max_epoch: 62
11-16 22:59:40 print_step: 25
11-16 22:59:40 inconsistent: UAN
11-16 22:59:40 model_name: WideResNet_sa
11-16 22:59:40 th: 0.5
11-16 22:59:40 input_channels: 21
11-16 22:59:40 classification_label: eol_class
11-16 22:59:40 sequence_length: 32
11-16 22:59:40 cycles_per_file: 30
11-16 22:59:40 sample_random_state: 42
11-16 22:59:40 transfer_task: [[0], [1]]
11-16 22:59:40 source_cathode: ['Li1.2Ni0.3Mn0.6O2', 'Li1.35Ni0.33Mn0.67O2.35']
11-16 22:59:40 target_cathode: ['5Vspinel']
11-16 22:59:40 num_classes: 5
11-16 22:59:40 domain_temperature: 1.0
11-16 22:59:40 class_temperature: 10.0
11-16 22:59:40 lambda_src: 0.0
11-16 22:59:40 lambda_src_decay_patience: 2
11-16 22:59:40 lambda_src_decay_factor: 0.5
11-16 22:59:40 lambda_src_min: 0.0
11-16 22:59:40 lambda_src_warmup: 0
11-16 22:59:40 improvement_metric: common
11-16 22:59:40 auto_select: True
11-16 22:59:40 llm_compare: True
11-16 22:59:40 llm_backend: openai
11-16 22:59:40 llm_model: None
11-16 22:59:40 llm_context: 
11-16 22:59:40 llm_cfg_inputs: {'text_context': "Dataset: Argonne National Laboratory battery aging time-series with partial cycle windows.\nSource cathodes: (all available); target cathodes: (none specified).\nLabel column 'eol_class' with ~None classes; sequence length 32; 7 channels covering cycle_number, energy_charge, capacity_charge, energy_discharge, capacity_discharge, cycle_start, cycle_duration.", 'numeric_summary': {'dataset': 'Battery_inconsistent', 'sequence_length_requested': 32, 'notes': 'label_inconsistent', 'lr_hint': 0.001, 'dropout_hint': 0.3, 'num_classes_hint': None, 'splits': {}, 'dataset_variant': 'argonne_battery', 'feature_names': ['cycle_number', 'energy_charge', 'capacity_charge', 'energy_discharge', 'capacity_discharge', 'cycle_start', 'cycle_duration'], 'source_cathodes': [], 'target_cathodes': [], 'label_column': 'eol_class'}}
11-16 22:59:40 llm_cfg: {'architecture': 'cnn_1d_sa', 'model_name': 'cnn_features_1d_sa', 'self_attention': True, 'sngp': True, 'openmax': False, 'use_unknown_head': False, 'bottleneck': 128, 'dropout': 0.3, 'learning_rate': 0.001, 'batch_size': 64, 'lambda_src': 0.0, 'rationale': 'The dataset has short sequences (32) and 7 channels, making a lightweight CNN with self-attention ideal to capture local features and some longer-range dependencies. The label inconsistency suggests avoiding openmax or unknown heads to reduce complexity and tuning overhead. Dropout at 0.3 balances overfitting risk due to label noise. Batch size 64 fits memory and training stability. This config should outperform the baseline deterministic CNN by leveraging attention without excessive capacity or open-set complexity. Label inconsistency flagged → calibrated heads (SNGP/OpenMax) stay enabled for open-set robustness. Enabled SNGP to stabilise open-set transfer risk detected in metadata.', '_provider': 'openai', '_raw': '{\n  "model_name": "cnn_features_1d_sa",\n  "self_attention": true,\n  "sngp": false,\n  "openmax": false,\n  "use_unknown_head": false,\n  "bottleneck": 128,\n  "dropout": 0.3,\n  "learning_rate": 0.001,\n  "batch_size": 64,\n  "lambda_src": 0.0,\n  "rationale": "The dataset has short sequences (32) and 7 channels, making a lightweight CNN with self-attention ideal to capture local features and some longer-range dependencies. The label inconsistency suggests avoiding openmax or unknown heads to reduce complexity and tuning overhead. Dropout at 0.3 balances overfitting risk due to label noise. Batch size 64 fits memory and training stability. This config should outperform the baseline deterministic CNN by leveraging attention without excessive capacity or open-set complexity."\n}'}
11-16 22:59:40 llm_cfg_stamp: 20251116_225503
11-16 22:59:40 tag: sngp_wrn_sa_20251116_225503
11-16 22:59:40 pretrained_model_path: ./checkpoint/transfer_WideResNet_sa_lirich_to_spinel5v_1116/best_model.pth
11-16 22:59:40 dataset_cycle_stats: {'source_train_cycles': 240, 'source_val_cycles': 60, 'source_val_has_holdout': True, 'target_train_cycles': 1230, 'target_val_cycles': 360, 'target_val_has_holdout': True, 'source_train_sequences': 8, 'source_val_sequences': 2, 'target_train_sequences': 41, 'target_val_sequences': 12, 'source_train_cells': 6, 'source_val_cells': 2, 'target_train_cells': 5, 'target_val_cells': 2, 'cycles_per_cell_per_cathode': {'source_train': {'Li1.2Ni0.3Mn0.6O2': [{'filename': 'batch_B3A_cell_4.h5', 'cycles': 30, 'total_cycles': 181}, {'filename': 'batch_B3B_cell_1.h5', 'cycles': 30, 'total_cycles': 181}, {'filename': 'batch_B3B_cell_2.h5', 'cycles': 30, 'total_cycles': 181}, {'filename': 'batch_B3B_cell_3.h5', 'cycles': 30, 'total_cycles': 180}, {'filename': 'batch_B3B_cell_7.h5', 'cycles': 30, 'total_cycles': 180}], 'Li1.35Ni0.33Mn0.67O2.35': [{'filename': 'batch_B13A_cell_4.h5', 'cycles': 30, 'total_cycles': 169}, {'filename': 'batch_B13A_cell_8.h5', 'cycles': 30, 'total_cycles': 218}, {'filename': 'batch_B8A_cell_1.h5', 'cycles': 30, 'total_cycles': 214}]}, 'source_val': {'Li1.2Ni0.3Mn0.6O2': [{'filename': 'batch_B3B_cell_5.h5', 'cycles': 30, 'total_cycles': 180}], 'Li1.35Ni0.33Mn0.67O2.35': [{'filename': 'batch_B13A_cell_13.h5', 'cycles': 30, 'total_cycles': 218}]}, 'target_train': {'5Vspinel': [{'filename': 'batch_B11B_cell_4.h5', 'cycles': 30, 'total_cycles': 216}, {'filename': 'batch_B26U_cell_5.h5', 'cycles': 30, 'total_cycles': 219}, {'filename': 'batch_B26V_cell_3.h5', 'cycles': 30, 'total_cycles': 420}, {'filename': 'batch_B26V_cell_4.h5', 'cycles': 30, 'total_cycles': 420}, {'filename': 'batch_B26V_cell_5.h5', 'cycles': 30, 'total_cycles': 219}, {'filename': 'batch_B26W_cell_1.h5', 'cycles': 30, 'total_cycles': 420}, {'filename': 'batch_B26W_cell_3.h5', 'cycles': 30, 'total_cycles': 420}, {'filename': 'batch_B26W_cell_4.h5', 'cycles': 30, 'total_cycles': 420}, {'filename': 'batch_B26W_cell_5.h5', 'cycles': 30, 'total_cycles': 219}, {'filename': 'batch_B26X_cell_1.h5', 'cycles': 30, 'total_cycles': 420}, {'filename': 'batch_B26X_cell_3.h5', 'cycles': 30, 'total_cycles': 420}, {'filename': 'batch_B26X_cell_4.h5', 'cycles': 30, 'total_cycles': 420}, {'filename': 'batch_B26Y_cell_3.h5', 'cycles': 30, 'total_cycles': 420}, {'filename': 'batch_B26Y_cell_4.h5', 'cycles': 30, 'total_cycles': 420}, {'filename': 'batch_B26Y_cell_5.h5', 'cycles': 30, 'total_cycles': 219}, {'filename': 'batch_B26Z_cell_1.h5', 'cycles': 30, 'total_cycles': 219}, {'filename': 'batch_B26Z_cell_3.h5', 'cycles': 30, 'total_cycles': 219}, {'filename': 'batch_B5A_cell_1.h5', 'cycles': 30, 'total_cycles': 846}, {'filename': 'batch_B5A_cell_5.h5', 'cycles': 30, 'total_cycles': 855}, {'filename': 'batch_B26V_cell_1.h5', 'cycles': 30, 'total_cycles': 420}, {'filename': 'batch_B26T_cell_5.h5', 'cycles': 30, 'total_cycles': 219}, {'filename': 'batch_B26AA_cell_1.h5', 'cycles': 30, 'total_cycles': 219}, {'filename': 'batch_B26T_cell_4.h5', 'cycles': 30, 'total_cycles': 219}, {'filename': 'batch_B26AA_cell_4.h5', 'cycles': 30, 'total_cycles': 219}, {'filename': 'batch_B26K_cell_1.h5', 'cycles': 30, 'total_cycles': 221}, {'filename': 'batch_B26L_cell_1.h5', 'cycles': 30, 'total_cycles': 2028}, {'filename': 'batch_B26N_cell_1.h5', 'cycles': 30, 'total_cycles': 219}, {'filename': 'batch_B26O_cell_1.h5', 'cycles': 30, 'total_cycles': 219}, {'filename': 'batch_B26O_cell_4.h5', 'cycles': 30, 'total_cycles': 219}, {'filename': 'batch_B26O_cell_5.h5', 'cycles': 30, 'total_cycles': 219}, {'filename': 'batch_B26P_cell_3.h5', 'cycles': 30, 'total_cycles': 421}, {'filename': 'batch_B26P_cell_4.h5', 'cycles': 30, 'total_cycles': 420}, {'filename': 'batch_B26Q_cell_3.h5', 'cycles': 30, 'total_cycles': 219}, {'filename': 'batch_B26Q_cell_5.h5', 'cycles': 30, 'total_cycles': 219}, {'filename': 'batch_B26R_cell_1.h5', 'cycles': 30, 'total_cycles': 420}, {'filename': 'batch_B26R_cell_3.h5', 'cycles': 30, 'total_cycles': 420}, {'filename': 'batch_B26R_cell_4.h5', 'cycles': 30, 'total_cycles': 420}, {'filename': 'batch_B26S_cell_3.h5', 'cycles': 30, 'total_cycles': 420}, {'filename': 'batch_B26S_cell_4.h5', 'cycles': 30, 'total_cycles': 420}, {'filename': 'batch_B26S_cell_5.h5', 'cycles': 30, 'total_cycles': 219}, {'filename': 'batch_B5A_cell_7.h5', 'cycles': 30, 'total_cycles': 687}]}, 'target_val': {'5Vspinel': [{'filename': 'batch_B26K_cell_2.h5', 'cycles': 30, 'total_cycles': 221}, {'filename': 'batch_B26L_cell_2.h5', 'cycles': 30, 'total_cycles': 2028}, {'filename': 'batch_B26M_cell_2.h5', 'cycles': 30, 'total_cycles': 219}, {'filename': 'batch_B26P_cell_2.h5', 'cycles': 30, 'total_cycles': 420}, {'filename': 'batch_B26P_cell_6.h5', 'cycles': 30, 'total_cycles': 219}, {'filename': 'batch_B26R_cell_2.h5', 'cycles': 30, 'total_cycles': 420}, {'filename': 'batch_B26T_cell_2.h5', 'cycles': 30, 'total_cycles': 220}, {'filename': 'batch_B26V_cell_2.h5', 'cycles': 30, 'total_cycles': 421}, {'filename': 'batch_B26X_cell_2.h5', 'cycles': 30, 'total_cycles': 420}, {'filename': 'batch_B26Y_cell_2.h5', 'cycles': 30, 'total_cycles': 421}, {'filename': 'batch_B26Z_cell_2.h5', 'cycles': 30, 'total_cycles': 219}, {'filename': 'batch_B5A_cell_2.h5', 'cycles': 30, 'total_cycles': 820}]}}, 'feature_columns': ('cycle_number', 'energy_charge', 'capacity_charge', 'energy_discharge', 'capacity_discharge', 'cycle_start', 'cycle_duration', 'capacity_retention', 'energy_retention', 'delta_capacity_discharge', 'delta_energy_discharge', 'delta_cycle_duration', 'rolling_capacity_mean', 'rolling_capacity_std', 'rolling_energy_mean', 'rolling_energy_std', 'rolling_duration_mean', 'duration_ratio', 'coulombic_efficiency', 'energy_efficiency', 'time_per_capacity')}
11-16 22:59:40 input_size: 32
11-16 22:59:40 reinit_head: False
11-16 22:59:40 using 1 cpu
11-16 22:59:40 Reducing learning rate to 5e-05 for 41 target samples
11-16 22:59:40 Freezing early layers of backbone for 41 target samples
11-16 22:59:40 Exception in callback functools.partial(<bound method OutStream._flush of <spyder_kernels.console.outstream.TTYOutStream object at 0x172cdca90>>)
Traceback (most recent call last):
  File "/Users/moondiab/opt/anaconda3/envs/venv/lib/python3.11/site-packages/jupyter_client/session.py", line 100, in json_packer
    ).encode("utf8", errors="surrogateescape")
      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
UnicodeEncodeError: 'utf-8' codec can't encode characters in position 1090-1091: surrogates not allowed

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/moondiab/opt/anaconda3/envs/venv/lib/python3.11/site-packages/tornado/ioloop.py", line 750, in _run_callback
    ret = callback()
          ^^^^^^^^^^
  File "/Users/moondiab/opt/anaconda3/envs/venv/lib/python3.11/site-packages/ipykernel/iostream.py", line 649, in _flush
    self.session.send(
  File "/Users/moondiab/opt/anaconda3/envs/venv/lib/python3.11/site-packages/jupyter_client/session.py", line 852, in send
    to_send = self.serialize(msg, ident)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/moondiab/opt/anaconda3/envs/venv/lib/python3.11/site-packages/jupyter_client/session.py", line 721, in serialize
    content = self.pack(content)
              ^^^^^^^^^^^^^^^^^^
  File "/Users/moondiab/opt/anaconda3/envs/venv/lib/python3.11/site-packages/jupyter_client/session.py", line 108, in json_packer
    ).encode("utf8", errors="surrogateescape")
      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
UnicodeEncodeError: 'utf-8' codec can't encode characters in position 1090-1091: surrogates not allowed
