11-14 17:23:39 data_name: Battery_inconsistent
11-14 17:23:39 data_dir: ./my_datasets/Battery
11-14 17:23:39 csv: ./my_datasets/Battery/battery_cycles_labeled.csv
11-14 17:23:39 normlizetype: mean-std
11-14 17:23:39 method: deterministic
11-14 17:23:39 gp_hidden_dim: 2048
11-14 17:23:39 spectral_norm_bound: 0.95
11-14 17:23:39 n_power_iterations: 1
11-14 17:23:39 nesterov: True
11-14 17:23:39 print_freq: 10
11-14 17:23:39 layers: 16
11-14 17:23:39 widen_factor: 1
11-14 17:23:39 droprate: 0.3
11-14 17:23:39 cuda_device: 0
11-14 17:23:39 checkpoint_dir: ./checkpoint
11-14 17:23:39 pretrained: True
11-14 17:23:39 batch_size: 64
11-14 17:23:39 num_workers: 0
11-14 17:23:39 bottleneck: True
11-14 17:23:39 bottleneck_num: 128
11-14 17:23:39 last_batch: False
11-14 17:23:39 hidden_size: 1024
11-14 17:23:39 trade_off_adversarial: Step
11-14 17:23:39 lam_adversarial: 1
11-14 17:23:39 opt: adam
11-14 17:23:39 lr: 5e-05
11-14 17:23:39 momentum: 0.9
11-14 17:23:39 weight_decay: 1e-05
11-14 17:23:39 lr_scheduler: step
11-14 17:23:39 gamma: 0.1
11-14 17:23:39 steps: 150, 250
11-14 17:23:39 middle_epoch: 15
11-14 17:23:39 max_epoch: 62
11-14 17:23:39 print_step: 25
11-14 17:23:39 inconsistent: UAN
11-14 17:23:39 model_name: cnn_features_1d
11-14 17:23:39 th: 0.5
11-14 17:23:39 input_channels: 22
11-14 17:23:39 classification_label: eol_class
11-14 17:23:39 sequence_length: 32
11-14 17:23:39 cycles_per_file: 50
11-14 17:23:39 sample_random_state: 42
11-14 17:23:39 transfer_task: [[0], [1]]
11-14 17:23:39 source_cathode: ['HE5050', 'NMC111', 'NMC532', 'NMC622', 'NMC811']
11-14 17:23:39 target_cathode: ['FCG']
11-14 17:23:39 num_classes: 5
11-14 17:23:39 domain_temperature: 1.0
11-14 17:23:39 class_temperature: 10.0
11-14 17:23:39 lambda_src: 0.0
11-14 17:23:39 lambda_src_decay_patience: 2
11-14 17:23:39 lambda_src_decay_factor: 0.5
11-14 17:23:39 lambda_src_min: 0.0
11-14 17:23:39 lambda_src_warmup: 0
11-14 17:23:39 improvement_metric: common
11-14 17:23:39 auto_select: True
11-14 17:23:39 llm_compare: True
11-14 17:23:39 llm_backend: openai
11-14 17:23:39 llm_model: None
11-14 17:23:39 llm_context: 
11-14 17:23:39 llm_cfg_inputs: {'text_context': "Dataset: Argonne National Laboratory battery aging time-series with partial cycle windows.\nSource cathodes: (all available); target cathodes: (none specified).\nLabel column 'eol_class' with ~None classes; sequence length 32; 7 channels covering cycle_number, energy_charge, capacity_charge, energy_discharge, capacity_discharge, cycle_start, cycle_duration.", 'numeric_summary': {'dataset': 'Battery_inconsistent', 'sequence_length_requested': 32, 'notes': 'label_inconsistent', 'lr_hint': 0.001, 'dropout_hint': 0.3, 'num_classes_hint': None, 'splits': {}, 'dataset_variant': 'argonne_battery', 'feature_names': ['cycle_number', 'energy_charge', 'capacity_charge', 'energy_discharge', 'capacity_discharge', 'cycle_start', 'cycle_duration'], 'source_cathodes': [], 'target_cathodes': [], 'label_column': 'eol_class'}}
11-14 17:23:39 llm_cfg: {'architecture': 'cnn_1d_sa', 'model_name': 'cnn_features_1d_sa', 'self_attention': True, 'sngp': True, 'openmax': False, 'use_unknown_head': False, 'bottleneck': 128, 'dropout': 0.3, 'learning_rate': 0.001, 'batch_size': 64, 'lambda_src': 0.0, 'rationale': 'The dataset has short sequences (length 32) and 7 channels, suitable for a CNN with self-attention to capture local and some longer-range dependencies without excessive memory use. Label inconsistency suggests avoiding openmax or unknown heads to reduce complexity. Dropout 0.3 balances overfitting risk due to label noise. The learning rate 0.001 and moderate batch size 64 support stable training with this architecture. Label inconsistency flagged â†’ calibrated heads (SNGP/OpenMax) stay enabled for open-set robustness. Enabled SNGP to stabilise open-set transfer risk detected in metadata.', '_provider': 'openai', '_raw': '{\n  "model_name": "cnn_features_1d_sa",\n  "self_attention": true,\n  "sngp": false,\n  "openmax": false,\n  "use_unknown_head": false,\n  "bottleneck": 128,\n  "dropout": 0.3,\n  "learning_rate": 0.001,\n  "batch_size": 64,\n  "lambda_src": 0.0,\n  "rationale": "The dataset has short sequences (length 32) and 7 channels, suitable for a CNN with self-attention to capture local and some longer-range dependencies without excessive memory use. Label inconsistency suggests avoiding openmax or unknown heads to reduce complexity. Dropout 0.3 balances overfitting risk due to label noise. The learning rate 0.001 and moderate batch size 64 support stable training with this architecture."\n}'}
11-14 17:23:39 llm_cfg_stamp: 20251114_170607
11-14 17:23:39 tag: detcnn_20251114_170607
11-14 17:23:39 pretrained_model_path: ./checkpoint/transfer_cnn_features_1d_nmc_to_fcg_1114/best_model.pth
11-14 17:23:39 dataset_cycle_stats: {'source_train_cycles': 8250, 'source_val_cycles': 3200, 'source_val_has_holdout': True, 'target_train_cycles': 250, 'target_val_cycles': 150, 'target_val_has_holdout': True, 'source_train_sequences': 3135, 'source_val_sequences': 1216, 'target_train_sequences': 95, 'target_val_sequences': 57, 'source_train_cells': 31, 'source_val_cells': 11, 'target_train_cells': 5, 'target_val_cells': 3}
11-14 17:23:39 input_size: 32
11-14 17:23:39 reinit_head: False
11-14 17:23:39 using 1 cpu
11-14 17:23:39 Reducing learning rate to 5e-05 for 95 target samples
11-14 17:23:39 Freezing early layers of backbone for 95 target samples
11-14 17:23:39 Exception in callback functools.partial(<bound method OutStream._flush of <spyder_kernels.console.outstream.TTYOutStream object at 0x172cdca90>>)
Traceback (most recent call last):
  File "/Users/moondiab/opt/anaconda3/envs/venv/lib/python3.11/site-packages/jupyter_client/session.py", line 100, in json_packer
    ).encode("utf8", errors="surrogateescape")
      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
UnicodeEncodeError: 'utf-8' codec can't encode characters in position 1004-1005: surrogates not allowed

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/moondiab/opt/anaconda3/envs/venv/lib/python3.11/site-packages/tornado/ioloop.py", line 750, in _run_callback
    ret = callback()
          ^^^^^^^^^^
  File "/Users/moondiab/opt/anaconda3/envs/venv/lib/python3.11/site-packages/ipykernel/iostream.py", line 649, in _flush
    self.session.send(
  File "/Users/moondiab/opt/anaconda3/envs/venv/lib/python3.11/site-packages/jupyter_client/session.py", line 852, in send
    to_send = self.serialize(msg, ident)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/moondiab/opt/anaconda3/envs/venv/lib/python3.11/site-packages/jupyter_client/session.py", line 721, in serialize
    content = self.pack(content)
              ^^^^^^^^^^^^^^^^^^
  File "/Users/moondiab/opt/anaconda3/envs/venv/lib/python3.11/site-packages/jupyter_client/session.py", line 108, in json_packer
    ).encode("utf8", errors="surrogateescape")
      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
UnicodeEncodeError: 'utf-8' codec can't encode characters in position 1004-1005: surrogates not allowed
